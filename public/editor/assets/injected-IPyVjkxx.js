var N=Object.defineProperty;var B=(S,a,p)=>a in S?N(S,a,{enumerable:!0,configurable:!0,writable:!0,value:p}):S[a]=p;var k=(S,a,p)=>B(S,typeof a!="symbol"?a+"":a,p);var C=function(){const S=()=>{},a={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:S,afterNodeAdded:S,beforeNodeMorphed:S,afterNodeMorphed:S,beforeNodeRemoved:S,afterNodeRemoved:S,beforeAttributeUpdated:S},head:{style:"merge",shouldPreserve:c=>c.getAttribute("im-preserve")==="true",shouldReAppend:c=>c.getAttribute("im-re-append")==="true",shouldRemove:S,afterHeadMorphed:S},restoreFocus:!0};function p(c,v,u={}){c=L(c);const f=H(v),h=I(c,f,u),l=O(h,()=>E(h,c,f,i=>i.morphStyle==="innerHTML"?(b(i,c,f),Array.from(c.childNodes)):y(i,c,f)));return h.pantry.remove(),l}function y(c,v,u){const f=H(v);return b(c,f,u,v,v.nextSibling),Array.from(f.childNodes)}function O(c,v){var r;if(!c.config.restoreFocus)return v();let u=document.activeElement;if(!(u instanceof HTMLInputElement||u instanceof HTMLTextAreaElement))return v();const{id:f,selectionStart:h,selectionEnd:l}=u,i=v();return f&&f!==((r=document.activeElement)==null?void 0:r.id)&&(u=c.target.querySelector(`[id="${f}"]`),u==null||u.focus()),u&&!u.selectionEnd&&l&&u.setSelectionRange(h,l),i}const b=function(){function c(e,t,n,s=null,o=null){t instanceof HTMLTemplateElement&&n instanceof HTMLTemplateElement&&(t=t.content,n=n.content),s||(s=t.firstChild);for(const d of n.childNodes){if(s&&s!=o){const m=u(e,d,s,o);if(m){m!==s&&h(e,s,m),A(m,d,e),s=m.nextSibling;continue}}if(d instanceof Element&&e.persistentIds.has(d.id)){const m=l(t,d.id,s,e);A(m,d,e),s=m.nextSibling;continue}const g=v(t,d,s,e);g&&(s=g.nextSibling)}for(;s&&s!=o;){const d=s;s=s.nextSibling,f(e,d)}}function v(e,t,n,s){if(s.callbacks.beforeNodeAdded(t)===!1)return null;if(s.idMap.has(t)){const o=document.createElement(t.tagName);return e.insertBefore(o,n),A(o,t,s),s.callbacks.afterNodeAdded(o),o}else{const o=document.importNode(t,!0);return e.insertBefore(o,n),s.callbacks.afterNodeAdded(o),o}}const u=function(){function e(s,o,d,g){let m=null,T=o.nextSibling,q=0,M=d;for(;M&&M!=g;){if(n(M,o)){if(t(s,M,o))return M;m===null&&(s.idMap.has(M)||(m=M))}if(m===null&&T&&n(M,T)&&(q++,T=T.nextSibling,q>=2&&(m=void 0)),M.contains(document.activeElement))break;M=M.nextSibling}return m||null}function t(s,o,d){let g=s.idMap.get(o),m=s.idMap.get(d);if(!m||!g)return!1;for(const T of g)if(m.has(T))return!0;return!1}function n(s,o){const d=s,g=o;return d.nodeType===g.nodeType&&d.tagName===g.tagName&&(!d.id||d.id===g.id)}return e}();function f(e,t){var n;if(e.idMap.has(t))r(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;(n=t.parentNode)==null||n.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function h(e,t,n){let s=t;for(;s&&s!==n;){let o=s;s=s.nextSibling,f(e,o)}return s}function l(e,t,n,s){const o=s.target.id===t&&s.target||s.target.querySelector(`[id="${t}"]`)||s.pantry.querySelector(`[id="${t}"]`);return i(o,s),r(e,o,n),o}function i(e,t){const n=e.id;for(;e=e.parentNode;){let s=t.idMap.get(e);s&&(s.delete(n),s.size||t.idMap.delete(e))}}function r(e,t,n){if(e.moveBefore)try{e.moveBefore(t,n)}catch{e.insertBefore(t,n)}else e.insertBefore(t,n)}return c}(),A=function(){function c(i,r,e){return e.ignoreActive&&i===document.activeElement?null:(e.callbacks.beforeNodeMorphed(i,r)===!1||(i instanceof HTMLHeadElement&&e.head.ignore||(i instanceof HTMLHeadElement&&e.head.style!=="morph"?w(i,r,e):(v(i,r,e),l(i,e)||b(e,i,r))),e.callbacks.afterNodeMorphed(i,r)),i)}function v(i,r,e){let t=r.nodeType;if(t===1){const n=i,s=r,o=n.attributes,d=s.attributes;for(const g of d)h(g.name,n,"update",e)||n.getAttribute(g.name)!==g.value&&n.setAttribute(g.name,g.value);for(let g=o.length-1;0<=g;g--){const m=o[g];if(m&&!s.hasAttribute(m.name)){if(h(m.name,n,"remove",e))continue;n.removeAttribute(m.name)}}l(n,e)||u(n,s,e)}(t===8||t===3)&&i.nodeValue!==r.nodeValue&&(i.nodeValue=r.nodeValue)}function u(i,r,e){if(i instanceof HTMLInputElement&&r instanceof HTMLInputElement&&r.type!=="file"){let t=r.value,n=i.value;f(i,r,"checked",e),f(i,r,"disabled",e),r.hasAttribute("value")?n!==t&&(h("value",i,"update",e)||(i.setAttribute("value",t),i.value=t)):h("value",i,"remove",e)||(i.value="",i.removeAttribute("value"))}else if(i instanceof HTMLOptionElement&&r instanceof HTMLOptionElement)f(i,r,"selected",e);else if(i instanceof HTMLTextAreaElement&&r instanceof HTMLTextAreaElement){let t=r.value,n=i.value;if(h("value",i,"update",e))return;t!==n&&(i.value=t),i.firstChild&&i.firstChild.nodeValue!==t&&(i.firstChild.nodeValue=t)}}function f(i,r,e,t){const n=r[e],s=i[e];if(n!==s){const o=h(e,i,"update",t);o||(i[e]=r[e]),n?o||i.setAttribute(e,""):h(e,i,"remove",t)||i.removeAttribute(e)}}function h(i,r,e,t){return i==="value"&&t.ignoreActiveValue&&r===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(i,r,e)===!1}function l(i,r){return!!r.ignoreActiveValue&&i===document.activeElement&&i!==document.body}return c}();function E(c,v,u,f){if(c.head.block){const h=v.querySelector("head"),l=u.querySelector("head");if(h&&l){const i=w(h,l,c);return Promise.all(i).then(()=>{const r=Object.assign(c,{head:{block:!1,ignore:!0}});return f(r)})}}return f(c)}function w(c,v,u){let f=[],h=[],l=[],i=[],r=new Map;for(const t of v.children)r.set(t.outerHTML,t);for(const t of c.children){let n=r.has(t.outerHTML),s=u.head.shouldReAppend(t),o=u.head.shouldPreserve(t);n||o?s?h.push(t):(r.delete(t.outerHTML),l.push(t)):u.head.style==="append"?s&&(h.push(t),i.push(t)):u.head.shouldRemove(t)!==!1&&h.push(t)}i.push(...r.values());let e=[];for(const t of i){let n=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(u.callbacks.beforeNodeAdded(n)!==!1){if("href"in n&&n.href||"src"in n&&n.src){let s,o=new Promise(function(d){s=d});n.addEventListener("load",function(){s()}),e.push(o)}c.appendChild(n),u.callbacks.afterNodeAdded(n),f.push(n)}}for(const t of h)u.callbacks.beforeNodeRemoved(t)!==!1&&(c.removeChild(t),u.callbacks.afterNodeRemoved(t));return u.head.afterHeadMorphed(c,{added:f,kept:l,removed:h}),e}const I=function(){function c(r,e,t){const{persistentIds:n,idMap:s}=l(r,e),o=v(t),d=o.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(d))throw`Do not understand how to morph style ${d}`;return{target:r,newContent:e,config:o,morphStyle:d,ignoreActive:o.ignoreActive,ignoreActiveValue:o.ignoreActiveValue,restoreFocus:o.restoreFocus,idMap:s,persistentIds:n,pantry:u(),callbacks:o.callbacks,head:o.head}}function v(r){let e=Object.assign({},a);return Object.assign(e,r),e.callbacks=Object.assign({},a.callbacks,r.callbacks),e.head=Object.assign({},a.head,r.head),e}function u(){const r=document.createElement("div");return r.hidden=!0,document.body.insertAdjacentElement("afterend",r),r}function f(r){let e=Array.from(r.querySelectorAll("[id]"));return r.id&&e.push(r),e}function h(r,e,t,n){for(const s of n)if(e.has(s.id)){let o=s;for(;o;){let d=r.get(o);if(d==null&&(d=new Set,r.set(o,d)),d.add(s.id),o===t)break;o=o.parentElement}}}function l(r,e){const t=f(r),n=f(e),s=i(t,n);let o=new Map;h(o,s,r,t);const d=e.__idiomorphRoot||e;return h(o,s,d,n),{persistentIds:s,idMap:o}}function i(r,e){let t=new Set,n=new Map;for(const{id:o,tagName:d}of r)n.has(o)?t.add(o):n.set(o,d);let s=new Set;for(const{id:o,tagName:d}of e)s.has(o)?t.add(o):n.get(o)===d&&s.add(o);for(const o of t)s.delete(o);return s}return c}(),{normalizeElement:L,normalizeParent:H}=function(){const c=new WeakSet;function v(l){return l instanceof Document?l.documentElement:l}function u(l){if(l==null)return document.createElement("div");if(typeof l=="string")return u(h(l));if(c.has(l))return l;if(l instanceof Node){if(l.parentNode)return new f(l);{const i=document.createElement("div");return i.append(l),i}}else{const i=document.createElement("div");for(const r of[...l])i.append(r);return i}}class f{constructor(i){this.originalNode=i,this.realParentNode=i.parentNode,this.previousSibling=i.previousSibling,this.nextSibling=i.nextSibling}get childNodes(){const i=[];let r=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;r&&r!=this.nextSibling;)i.push(r),r=r.nextSibling;return i}querySelectorAll(i){return this.childNodes.reduce((r,e)=>{if(e instanceof Element){e.matches(i)&&r.push(e);const t=e.querySelectorAll(i);for(let n=0;n<t.length;n++)r.push(t[n])}return r},[])}insertBefore(i,r){return this.realParentNode.insertBefore(i,r)}moveBefore(i,r){return this.realParentNode.moveBefore(i,r)}get __idiomorphRoot(){return this.originalNode}}function h(l){let i=new DOMParser,r=l.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(r.match(/<\/html>/)||r.match(/<\/head>/)||r.match(/<\/body>/)){let e=i.parseFromString(l,"text/html");if(r.match(/<\/html>/))return c.add(e),e;{let t=e.firstChild;return t&&c.add(t),t}}else{let t=i.parseFromString("<body><template>"+l+"</template></body>","text/html").body.querySelector("template").content;return c.add(t),t}}return{normalizeElement:v,normalizeParent:u}}();return{morph:p,defaults:a}}();window.addEventListener("DOMContentLoaded",function(){new V().init()});class V{constructor(){k(this,"sectionOverlay");k(this,"sectionLabel");k(this,"activeSectionId",null);k(this,"sectionsOrder",[])}init(){var a,p,y,O,b;this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),window.addEventListener("message",({data:A})=>{this.handleMessage(A)}),(a=this.sectionOverlay.querySelector("#move-up"))==null||a.addEventListener("click",this.moveActiveSectionUp.bind(this)),(p=this.sectionOverlay.querySelector("#move-down"))==null||p.addEventListener("click",this.moveActiveSectionDown.bind(this)),(y=this.sectionOverlay.querySelector("#edit"))==null||y.addEventListener("click",this.editActiveSection.bind(this)),(O=this.sectionOverlay.querySelector("#disable"))==null||O.addEventListener("click",this.disableActiveSection.bind(this)),(b=this.sectionOverlay.querySelector("#remove"))==null||b.addEventListener("click",this.removeActiveSection.bind(this)),this.attachMouseEventsToSections(),this.postMessage("initialize",{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema}),this.sectionsOrder=window.themeData.sectionsOrder,this.extractUsedColors()}attachMouseEventsToSections(){document.querySelectorAll("[data-section-type]").forEach(a=>{a.hasAttribute("data-visual-initialized")||(a.addEventListener("mouseover",this.onSectionHover.bind(this,a)),a.addEventListener("mouseleave",p=>{p.toElement&&(console.log(this.sectionOverlay.contains(p.toElement)),!!p.toElement.closest("#section-overlay"))||this.onSectionBlur.call(this,a)}),a.setAttribute("data-visual-initialized","true"))})}highlightSection(a){this.activeSectionId=a.dataset.sectionId,this.sectionOverlay.style.display="block",this.sectionOverlay.style.width=a.offsetWidth+"px",this.sectionOverlay.style.height=a.offsetHeight+"px",this.sectionOverlay.style.left=a.offsetLeft+"px",this.sectionOverlay.style.top=a.offsetTop+"px",a.dataset.sectionType,this.sectionLabel.textContent=a.dataset.sectionName,this.sectionOverlay.querySelector("#move-up").style.display="none",this.sectionOverlay.querySelector("#move-down").style.display="none";const p=this.sectionsOrder.indexOf(this.activeSectionId);p>0&&(this.sectionOverlay.querySelector("#move-up").style.display="inline"),p<this.sectionsOrder.length-1&&(this.sectionOverlay.querySelector("#move-down").style.display="inline")}clearActiveSection(){this.activeSectionId=null,this.sectionOverlay.style.display="none"}onSectionHover(a){this.activeSectionId!==a.dataset.sectionId&&this.highlightSection(a)}onSectionBlur(a){this.activeSectionId===a.dataset.sectionId&&this.clearActiveSection()}moveActiveSectionUp(){this.postMessage("moveSectionUp",this.activeSectionId)}moveActiveSectionDown(){this.postMessage("moveSectionDown",this.activeSectionId)}editActiveSection(){this.postMessage("editSection",this.activeSectionId)}disableActiveSection(){this.postMessage("toggleSection",this.activeSectionId)}removeActiveSection(){this.postMessage("removeSection",this.activeSectionId)}refreshPreviewer(a){const p=new DOMParser().parseFromString(a,"text/html");C.morph(document.documentElement,p.documentElement,{callbacks:{beforeNodeMorphed(y,O){return typeof y._x_dataStack<"u"&&typeof window.Alpine.morph<"u"?(window.Alpine.morph(y,O),!1):!0}}}),this.attachMouseEventsToSections()}postMessage(a,p){window.parent.postMessage({type:a,data:p},window.origin)}handleMessage({type:a,data:p}){switch(a){case"highlightSection":const y=document.querySelector(`[data-section-id="${p}"]`);y&&(this.highlightSection(y),y.scrollIntoView({behavior:"smooth"}));break;case"clearActiveSection":this.clearActiveSection();break;case"sectionsOrder":this.sectionsOrder=p;break;case"refresh":this.refreshPreviewer(p);break}}extractUsedColors(a=6){const p=new Map;document.querySelectorAll("*").forEach(b=>{const A=getComputedStyle(b),E=A.backgroundColor,w=A.color,I=L=>{L!=="transparent"&&L!=="rgba(0, 0, 0, 0)"&&L!==""&&p.set(L,(p.get(L)||0)+1)};I(E),I(w)});const O=Array.from(p.entries()).sort((b,A)=>A[1]-b[1]).map(b=>b[0]).slice(0,a);this.postMessage("usedColors",O)}}
