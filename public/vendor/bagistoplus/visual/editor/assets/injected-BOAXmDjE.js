var oe=Object.defineProperty;var de=(a,e,t)=>e in a?oe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var S=(a,e,t)=>de(a,typeof e!="symbol"?e+"":e,t);var J=11;function ce(a,e){var t=e.attributes,i,n,r,d,v;if(!(e.nodeType===J||a.nodeType===J)){for(var g=t.length-1;g>=0;g--)i=t[g],n=i.name,r=i.namespaceURI,d=i.value,r?(n=i.localName||n,v=a.getAttributeNS(r,n),v!==d&&(i.prefix==="xmlns"&&(n=i.name),a.setAttributeNS(r,n,d))):(v=a.getAttribute(n),v!==d&&a.setAttribute(n,d));for(var p=a.attributes,l=p.length-1;l>=0;l--)i=p[l],n=i.name,r=i.namespaceURI,r?(n=i.localName||n,e.hasAttributeNS(r,n)||a.removeAttributeNS(r,n)):e.hasAttribute(n)||a.removeAttribute(n)}}var $,le="http://www.w3.org/1999/xhtml",T=typeof document>"u"?void 0:document,he=!!T&&"content"in T.createElement("template"),ue=!!T&&T.createRange&&"createContextualFragment"in T.createRange();function ve(a){var e=T.createElement("template");return e.innerHTML=a,e.content.childNodes[0]}function fe(a){$||($=T.createRange(),$.selectNode(T.body));var e=$.createContextualFragment(a);return e.childNodes[0]}function Se(a){var e=T.createElement("body");return e.innerHTML=a,e.childNodes[0]}function pe(a){return a=a.trim(),he?ve(a):ue?fe(a):Se(a)}function k(a,e){var t=a.nodeName,i=e.nodeName,n,r;return t===i?!0:(n=t.charCodeAt(0),r=i.charCodeAt(0),n<=90&&r>=97?t===i.toUpperCase():r<=90&&n>=97?i===t.toUpperCase():!1)}function Ee(a,e){return!e||e===le?T.createElement(a):T.createElementNS(e,a)}function ge(a,e){for(var t=a.firstChild;t;){var i=t.nextSibling;e.appendChild(t),t=i}return e}function W(a,e,t){a[t]!==e[t]&&(a[t]=e[t],a[t]?a.setAttribute(t,""):a.removeAttribute(t))}var Q={OPTION:function(a,e){var t=a.parentNode;if(t){var i=t.nodeName.toUpperCase();i==="OPTGROUP"&&(t=t.parentNode,i=t&&t.nodeName.toUpperCase()),i==="SELECT"&&!t.hasAttribute("multiple")&&(a.hasAttribute("selected")&&!e.selected&&(a.setAttribute("selected","selected"),a.removeAttribute("selected")),t.selectedIndex=-1)}W(a,e,"selected")},INPUT:function(a,e){W(a,e,"checked"),W(a,e,"disabled"),a.value!==e.value&&(a.value=e.value),e.hasAttribute("value")||a.removeAttribute("value")},TEXTAREA:function(a,e){var t=e.value;a.value!==t&&(a.value=t);var i=a.firstChild;if(i){var n=i.nodeValue;if(n==t||!t&&n==a.placeholder)return;i.nodeValue=t}},SELECT:function(a,e){if(!e.hasAttribute("multiple")){for(var t=-1,i=0,n=a.firstChild,r,d;n;)if(d=n.nodeName&&n.nodeName.toUpperCase(),d==="OPTGROUP")r=n,n=r.firstChild;else{if(d==="OPTION"){if(n.hasAttribute("selected")){t=i;break}i++}n=n.nextSibling,!n&&r&&(n=r.nextSibling,r=null)}a.selectedIndex=t}}},L=1,ee=11,te=3,ie=8;function b(){}function Te(a){if(a)return a.getAttribute&&a.getAttribute("id")||a.id}function me(a){return function(t,i,n){if(n||(n={}),typeof i=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var r=i;i=T.createElement("html"),i.innerHTML=r}else i=pe(i);else i.nodeType===ee&&(i=i.firstElementChild);var d=n.getNodeKey||Te,v=n.onBeforeNodeAdded||b,g=n.onNodeAdded||b,p=n.onBeforeElUpdated||b,l=n.onElUpdated||b,w=n.onBeforeNodeDiscarded||b,m=n.onNodeDiscarded||b,I=n.onBeforeElChildrenUpdated||b,ne=n.skipFromChildren||b,X=n.addChild||function(s,o){return s.appendChild(o)},P=n.childrenOnly===!0,N=Object.create(null),M=[];function R(s){M.push(s)}function j(s,o){if(s.nodeType===L)for(var u=s.firstChild;u;){var c=void 0;o&&(c=d(u))?R(c):(m(u),u.firstChild&&j(u,o)),u=u.nextSibling}}function U(s,o,u){w(s)!==!1&&(o&&o.removeChild(s),m(s),j(s,u))}function q(s){if(s.nodeType===L||s.nodeType===ee)for(var o=s.firstChild;o;){var u=d(o);u&&(N[u]=o),q(o),o=o.nextSibling}}q(t);function G(s){g(s);for(var o=s.firstChild;o;){var u=o.nextSibling,c=d(o);if(c){var h=N[c];h&&k(o,h)?(o.parentNode.replaceChild(h,o),x(h,o)):G(o)}else G(o);o=u}}function ae(s,o,u){for(;o;){var c=o.nextSibling;(u=d(o))?R(u):U(o,s,!0),o=c}}function x(s,o,u){var c=d(o);if(c&&delete N[c],!u){var h=p(s,o);if(h===!1||(h instanceof HTMLElement&&(s=h,q(s)),a(s,o),l(s),I(s,o)===!1))return}s.nodeName!=="TEXTAREA"?re(s,o):Q.TEXTAREA(s,o)}function re(s,o){var u=ne(s,o),c=o.firstChild,h=s.firstChild,D,O,_,B,y;e:for(;c;){for(B=c.nextSibling,D=d(c);!u&&h;){if(_=h.nextSibling,c.isSameNode&&c.isSameNode(h)){c=B,h=_;continue e}O=d(h);var H=h.nodeType,A=void 0;if(H===c.nodeType&&(H===L?(D?D!==O&&((y=N[D])?_===y?A=!1:(s.insertBefore(y,h),O?R(O):U(h,s,!0),h=y,O=d(h)):A=!1):O&&(A=!1),A=A!==!1&&k(h,c),A&&x(h,c)):(H===te||H==ie)&&(A=!0,h.nodeValue!==c.nodeValue&&(h.nodeValue=c.nodeValue))),A){c=B,h=_;continue e}O?R(O):U(h,s,!0),h=_}if(D&&(y=N[D])&&k(y,c))u||X(s,y),x(y,c);else{var K=v(c);K!==!1&&(K&&(c=K),c.actualize&&(c=c.actualize(s.ownerDocument||T)),X(s,c),G(c))}c=B,h=_}ae(s,h,O);var Y=Q[s.nodeName];Y&&Y(s,o)}var E=t,V=E.nodeType,Z=i.nodeType;if(!P){if(V===L)Z===L?k(t,i)||(m(t),E=ge(t,Ee(i.nodeName,i.namespaceURI))):E=i;else if(V===te||V===ie){if(Z===V)return E.nodeValue!==i.nodeValue&&(E.nodeValue=i.nodeValue),E;E=i}}if(E===i)m(t);else{if(i.isSameNode&&i.isSameNode(E))return;if(x(E,i,P),M)for(var F=0,se=M.length;F<se;F++){var z=N[M[F]];z&&U(z,z.parentNode,!1)}}return!P&&E!==t&&t.parentNode&&(E.actualize&&(E=E.actualize(t.ownerDocument||T)),t.parentNode.replaceChild(E,t)),E}}var we=me(ce);const C={INITIALIZE:"initialize",MOVE_SECTION_UP:"section:move-up",MOVE_SECTION_DOWN:"section:move-down",EDIT_SECTION:"section:edit",TOGGLE_SECTION:"section:toggle",REMOVE_SECTION:"section:remove",SET_USED_COLORS:"usedColors"},f={prefix:"visual:",EDITOR_INITIALIZED:"editor:init",SETTING_UPDATED:"setting:updated",SECTION_HIGHLIGHT:"section:highlight",SECTION_SELECTED:"section:selected",BLOCK_SELECTED:"block:selected",SECTION_ADDED:"section:added",SECTION_REMOVED:"section:removed",CLEAR_ACTIVE_SECTION:"clearActiveSection",SECTIONS_REORDERED:"sectionsOrder",REFRESH_PREVIEW:"refresh",REORDERING:"reordering"};class Ie{constructor(){S(this,"inDesignMode",!0);S(this,"inPreviewMode",!1)}on(e,t){const i=e.startsWith(f.prefix)?e:f.prefix+e,n=r=>t(r.detail);return document.addEventListener(i,n),()=>document.removeEventListener(i,n)}_dispatch(e,t){const i=f.prefix+e;document.dispatchEvent(new CustomEvent(i,{detail:t,bubbles:!0}))}handleLiveUpdate(e,t){this.on(f.SETTING_UPDATED,({data:i,skipRefresh:n})=>{var I;const{section:r,block:d,settingId:v,settingValue:g}=i;if(!r||r.type!==e)return;const p=document.querySelector(`[data-section-id="${r.id}"]`);if(!p)return;let l;if(d&&((I=t.blocks)!=null&&I[d.type])?l=t.blocks[d.type][v]:t.section&&(l=t.section[v]),!l)return;const w=l.target?p.querySelector(l.target):null;if(!w)return;const m=typeof l.transform=="function"?l.transform(g):g;typeof l.handler=="function"?l.handler(w,m):l.html?w.innerHTML=m:l.text?w.textContent=m:l.style?w.style[l.style]=m:l.attr&&w.setAttribute(l.attr,m),n()})}}window.Visual=new Ie;class Oe{constructor(){S(this,"sectionOverlay");S(this,"sectionLabel");S(this,"moveUpBtn");S(this,"moveDownBtn");S(this,"editBtn");S(this,"disableBtn");S(this,"removeBtn");S(this,"buttonsContainer");S(this,"activeSectionId",null);S(this,"sectionsOrder",[]);S(this,"hoverDebounce",0);S(this,"reorderingSectionId",null);S(this,"discardLivewireComponentNotFoundError",!1);S(this,"messageHandlers",{[f.SECTION_HIGHLIGHT]:e=>this.handleSectionHighlight(e),[f.SECTION_SELECTED]:e=>this.handleSectionSelected(e),[f.BLOCK_SELECTED]:e=>this.handleBlockSelected(e),[f.SECTION_ADDED]:e=>this.handleSectionAdded(e),[f.SECTION_REMOVED]:e=>this.handleSectionRemoved(e),[f.CLEAR_ACTIVE_SECTION]:()=>this.handleClearActiveSection(),[f.SECTIONS_REORDERED]:e=>this.handleSectionsReordered(e),[f.REORDERING]:e=>this.handleReordering(e),[f.REFRESH_PREVIEW]:e=>this.refreshPreviewer(e),[f.SETTING_UPDATED]:(e,t)=>this.handleSettingUpdated(e,t)})}init(){this.initializeUIElements(),this.attachButtonEvents(),this.attachMouseEvents(),this.postMessage(C.INITIALIZE,{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema,preloadedModels:window.preloadedModels}),this.sectionsOrder=window.themeData.sectionsOrder,window.addEventListener("message",({data:e})=>this.handleMessage(e)),window.addEventListener("resize",()=>this.handleWindowResize()),this.extractUsedColors(),window.addEventListener("error",e=>{this.discardLivewireComponentNotFoundError&&e.message==="Uncaught Could not find Livewire component in DOM tree"&&e.preventDefault()})}initializeUIElements(){this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),this.buttonsContainer=document.querySelector("#buttons"),this.moveUpBtn=this.sectionOverlay.querySelector("#move-up"),this.moveDownBtn=this.sectionOverlay.querySelector("#move-down"),this.editBtn=this.sectionOverlay.querySelector("#edit"),this.disableBtn=this.sectionOverlay.querySelector("#disable"),this.removeBtn=this.sectionOverlay.querySelector("#remove")}attachButtonEvents(){this.moveUpBtn.onclick=()=>this.postMessage(C.MOVE_SECTION_UP,this.activeSectionId),this.moveDownBtn.onclick=()=>this.postMessage(C.MOVE_SECTION_DOWN,this.activeSectionId),this.editBtn.onclick=()=>this.postMessage(C.EDIT_SECTION,this.activeSectionId),this.disableBtn.onclick=()=>this.postMessage(C.TOGGLE_SECTION,this.activeSectionId),this.removeBtn.onclick=()=>this.postMessage(C.REMOVE_SECTION,this.activeSectionId)}attachMouseEvents(){document.addEventListener("mouseover",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest("[data-section-type]");t&&t.dataset.sectionId!==this.activeSectionId&&(this.buttonsContainer.style.display="flex",this.debounceHighlight(t))},{passive:!0}),document.addEventListener("mouseleave",e=>{if(!(e.target instanceof Element)){this.buttonsContainer.style.display="none",this.clearActiveSection();return}if(!e.target.closest("[data-section-type]"))return;const i=e.relatedTarget;(!i||!this.sectionOverlay.contains(i))&&(this.buttonsContainer.style.display="none",this.clearActiveSection())},{passive:!0})}handleWindowResize(){if(this.activeSectionId){const e=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);e&&this.highlightSection(e)}}debounceHighlight(e){clearTimeout(this.hoverDebounce),this.hoverDebounce=window.setTimeout(()=>{this.highlightSection(e)},50)}handleMessage({type:e,data:t,messageId:i}){const n=this.messageHandlers[e];n?n(t,i):window.Visual._dispatch(e,t)}handleSectionHighlight(e){if(this.reorderingSectionId)return;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),t.setAttribute("data-visual-highlighted","true"))}handleSectionSelected(e){if(this.activeSectionId===e)return;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(this.highlightSection(t),t.scrollIntoView({behavior:"smooth",block:"start"}),window.Visual._dispatch(f.SECTION_SELECTED,{section:{id:t.dataset.sectionId,type:t.dataset.sectionType}}))}handleBlockSelected(e){this.handleSectionSelected(e.sectionId),window.Visual._dispatch(f.BLOCK_SELECTED,e)}handleSectionAdded({section:e}){this.handleSectionHighlight(e.id),window.Visual._dispatch(f.SECTION_ADDED,{section:e})}handleSectionRemoved(e){const t=document.querySelector(`[data-section-id="${e.id}"]`);t&&t.remove()}handleClearActiveSection(){this.clearActiveSection(),document.querySelectorAll("[data-visual-highlighted]").forEach(e=>{e.removeAttribute("data-visual-highlighted")})}handleSectionsReordered(e){this.sectionsOrder=e,this.reorderingSectionId=null,document.querySelectorAll("[data-reordering]").forEach(t=>{t.removeAttribute("data-reordering")})}handleReordering(e){this.reorderingSectionId=e.sectionId,e.order.forEach(i=>{const n=document.querySelector(`[data-section-id="${i}"]`);n!=null&&n.parentElement&&n.parentElement.appendChild(n)});const t=document.querySelector(`[data-section-id="${e.sectionId}"]`);t&&requestAnimationFrame(()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"}),t.dataset.reordering="true"})}handleSettingUpdated(e,t){let i=this.autoHandleLiveUpdate(e);if(i||window.Visual._dispatch(f.SETTING_UPDATED,{data:e,skipRefresh:()=>{i=!0}}),this.activeSectionId){const n=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);n&&this.highlightSection(n)}t&&window.parent.postMessage({messageId:t,skipRefresh:i},window.origin)}highlightSection(e){this.activeSectionId=e.dataset.sectionId;const t=e.getBoundingClientRect();window.requestAnimationFrame(()=>{Object.assign(this.sectionOverlay.style,{display:"block",width:`${t.width}px`,height:`${t.height}px`,left:`${t.left+window.scrollX}px`,top:`${t.top+window.scrollY}px`}),this.sectionLabel.textContent=e.dataset.sectionName||"";const i=this.sectionsOrder.indexOf(this.activeSectionId);this.moveUpBtn.style.display=i>0?"inline":"none",this.moveDownBtn.style.display=i>0&&i<this.sectionsOrder.length-1?"inline":"none"})}clearActiveSection(){this.activeSectionId=null,this.sectionOverlay.style.display="none"}autoHandleLiveUpdate(e){const{section:t,block:i,settingId:n,settingValue:r}=e,v=`data-live-update-${[t==null?void 0:t.id,i==null?void 0:i.id,n].filter(Boolean).join(".")}`,g=`[${CSS.escape(v)}]`,p=document.querySelectorAll(g);return p.length?(p.forEach(l=>{const w=l.getAttribute(v),[m,I]=(w==null?void 0:w.split(":"))??["text",void 0];switch(m){case"text":l.textContent=r;break;case"html":l.innerHTML=r;break;case"outerHTML":l.outerHTML=r;break;case"attr":r?l.setAttribute(I,r):l.removeAttribute(I);break;case"style":r?l.style.setProperty(I,r):l.style.removeProperty(I);break;default:console.warn(`Unknown live update type: ${m}`)}}),!0):!1}patchNode(e,t){const i=this;we(e,t,{onBeforeElUpdated(n,r){var d;if(n instanceof HTMLElement&&n.hasAttribute("wire:id")){const v=n.__livewire,g=r.getAttribute("wire:snapshot"),p=JSON.parse(r.getAttribute("wire:effects"));return p.html=r.outerHTML,v.mergeNewSnapshot(g,p),i.discardLivewireComponentNotFoundError=!0,v.processEffects(p),setTimeout(()=>{i.discardLivewireComponentNotFoundError=!1}),!1}return n._x_dataStack&&typeof((d=window.Alpine)==null?void 0:d.morph)=="function"?(window.Alpine.morph(n,r,{updating(v,g,p){if(v instanceof HTMLElement&&g instanceof HTMLElement&&v.hasAttribute("wire:id"))return p()}}),!1):!0}})}refreshPreviewer({html:e,updatedSections:t}){const i=new DOMParser().parseFromString(e,"text/html");if(t.size===0?this.patchNode(document.documentElement,i.documentElement):t.forEach((n,r)=>{const d=document.querySelector(`[data-section-id="${r}"]`),v=i.querySelector(`[data-section-id="${r}"]`);!d||!v||(this.patchNode(d,v),window.Visual._dispatch("section:updated",n))}),this.activeSectionId){const n=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);n&&this.highlightSection(n)}}postMessage(e,t){window.parent.postMessage({type:e,data:t},window.origin)}extractUsedColors(e=6){const t=new Map;document.querySelectorAll("*").forEach(n=>{const r=getComputedStyle(n);[r.backgroundColor,r.color].forEach(d=>{d&&d!=="transparent"&&d!=="rgba(0, 0, 0, 0)"&&t.set(d,(t.get(d)||0)+1)})});const i=Array.from(t.entries()).sort((n,r)=>r[1]-n[1]).slice(0,e).map(([n])=>n);this.postMessage(C.SET_USED_COLORS,i)}}window.addEventListener("DOMContentLoaded",()=>{new Oe().init(),document.dispatchEvent(new CustomEvent(f.prefix+f.EDITOR_INITIALIZED,{bubbles:!0}))});
