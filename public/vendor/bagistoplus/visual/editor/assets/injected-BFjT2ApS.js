var oe=Object.defineProperty;var ce=(s,e,t)=>e in s?oe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var T=(s,e,t)=>ce(s,typeof e!="symbol"?e+"":e,t);var J=11;function de(s,e){var t=e.attributes,i,n,a,c,f;if(!(e.nodeType===J||s.nodeType===J)){for(var E=t.length-1;E>=0;E--)i=t[E],n=i.name,a=i.namespaceURI,c=i.value,a?(n=i.localName||n,f=s.getAttributeNS(a,n),f!==c&&(i.prefix==="xmlns"&&(n=i.name),s.setAttributeNS(a,n,c))):(f=s.getAttribute(n),f!==c&&s.setAttribute(n,c));for(var v=s.attributes,d=v.length-1;d>=0;d--)i=v[d],n=i.name,a=i.namespaceURI,a?(n=i.localName||n,e.hasAttributeNS(a,n)||s.removeAttributeNS(a,n)):e.hasAttribute(n)||s.removeAttribute(n)}}var x,le="http://www.w3.org/1999/xhtml",w=typeof document>"u"?void 0:document,he=!!w&&"content"in w.createElement("template"),ue=!!w&&w.createRange&&"createContextualFragment"in w.createRange();function fe(s){var e=w.createElement("template");return e.innerHTML=s,e.content.childNodes[0]}function ve(s){x||(x=w.createRange(),x.selectNode(w.body));var e=x.createContextualFragment(s);return e.childNodes[0]}function Se(s){var e=w.createElement("body");return e.innerHTML=s,e.childNodes[0]}function Ee(s){return s=s.trim(),he?fe(s):ue?ve(s):Se(s)}function k(s,e){var t=s.nodeName,i=e.nodeName,n,a;return t===i?!0:(n=t.charCodeAt(0),a=i.charCodeAt(0),n<=90&&a>=97?t===i.toUpperCase():a<=90&&n>=97?i===t.toUpperCase():!1)}function pe(s,e){return!e||e===le?w.createElement(s):w.createElementNS(e,s)}function Te(s,e){for(var t=s.firstChild;t;){var i=t.nextSibling;e.appendChild(t),t=i}return e}function W(s,e,t){s[t]!==e[t]&&(s[t]=e[t],s[t]?s.setAttribute(t,""):s.removeAttribute(t))}var Q={OPTION:function(s,e){var t=s.parentNode;if(t){var i=t.nodeName.toUpperCase();i==="OPTGROUP"&&(t=t.parentNode,i=t&&t.nodeName.toUpperCase()),i==="SELECT"&&!t.hasAttribute("multiple")&&(s.hasAttribute("selected")&&!e.selected&&(s.setAttribute("selected","selected"),s.removeAttribute("selected")),t.selectedIndex=-1)}W(s,e,"selected")},INPUT:function(s,e){W(s,e,"checked"),W(s,e,"disabled"),s.value!==e.value&&(s.value=e.value),e.hasAttribute("value")||s.removeAttribute("value")},TEXTAREA:function(s,e){var t=e.value;s.value!==t&&(s.value=t);var i=s.firstChild;if(i){var n=i.nodeValue;if(n==t||!t&&n==s.placeholder)return;i.nodeValue=t}},SELECT:function(s,e){if(!e.hasAttribute("multiple")){for(var t=-1,i=0,n=s.firstChild,a,c;n;)if(c=n.nodeName&&n.nodeName.toUpperCase(),c==="OPTGROUP")a=n,n=a.firstChild;else{if(c==="OPTION"){if(n.hasAttribute("selected")){t=i;break}i++}n=n.nextSibling,!n&&a&&(n=a.nextSibling,a=null)}s.selectedIndex=t}}},L=1,ee=11,te=3,ie=8;function N(){}function ge(s){if(s)return s.getAttribute&&s.getAttribute("id")||s.id}function we(s){return function(t,i,n){if(n||(n={}),typeof i=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var a=i;i=w.createElement("html"),i.innerHTML=a}else i=Ee(i);else i.nodeType===ee&&(i=i.firstElementChild);var c=n.getNodeKey||ge,f=n.onBeforeNodeAdded||N,E=n.onNodeAdded||N,v=n.onBeforeElUpdated||N,d=n.onElUpdated||N,p=n.onBeforeNodeDiscarded||N,m=n.onNodeDiscarded||N,O=n.onBeforeElChildrenUpdated||N,ne=n.skipFromChildren||N,X=n.addChild||function(r,o){return r.appendChild(o)},q=n.childrenOnly===!0,_=Object.create(null),M=[];function R(r){M.push(r)}function j(r,o){if(r.nodeType===L)for(var S=r.firstChild;S;){var l=void 0;o&&(l=c(S))?R(l):(m(S),S.firstChild&&j(S,o)),S=S.nextSibling}}function U(r,o,S){p(r)!==!1&&(o&&o.removeChild(r),m(r),j(r,S))}function P(r){if(r.nodeType===L||r.nodeType===ee)for(var o=r.firstChild;o;){var S=c(o);S&&(_[S]=o),P(o),o=o.nextSibling}}P(t);function G(r){E(r);for(var o=r.firstChild;o;){var S=o.nextSibling,l=c(o);if(l){var u=_[l];u&&k(o,u)?(o.parentNode.replaceChild(u,o),B(u,o)):G(o)}else G(o);o=S}}function se(r,o,S){for(;o;){var l=o.nextSibling;(S=c(o))?R(S):U(o,r,!0),o=l}}function B(r,o,S){var l=c(o);if(l&&delete _[l],!S){var u=v(r,o);if(u===!1||(u instanceof HTMLElement&&(r=u,P(r)),s(r,o),d(r),O(r,o)===!1))return}r.nodeName!=="TEXTAREA"?ae(r,o):Q.TEXTAREA(r,o)}function ae(r,o){var S=ne(r,o),l=o.firstChild,u=r.firstChild,A,I,D,H,C;e:for(;l;){for(H=l.nextSibling,A=c(l);!S&&u;){if(D=u.nextSibling,l.isSameNode&&l.isSameNode(u)){l=H,u=D;continue e}I=c(u);var $=u.nodeType,y=void 0;if($===l.nodeType&&($===L?(A?A!==I&&((C=_[A])?D===C?y=!1:(r.insertBefore(C,u),I?R(I):U(u,r,!0),u=C,I=c(u)):y=!1):I&&(y=!1),y=y!==!1&&k(u,l),y&&B(u,l)):($===te||$==ie)&&(y=!0,u.nodeValue!==l.nodeValue&&(u.nodeValue=l.nodeValue))),y){l=H,u=D;continue e}I?R(I):U(u,r,!0),u=D}if(A&&(C=_[A])&&k(C,l))S||X(r,C),B(C,l);else{var z=f(l);z!==!1&&(z&&(l=z),l.actualize&&(l=l.actualize(r.ownerDocument||w)),X(r,l),G(l))}l=H,u=D}se(r,u,I);var Y=Q[r.nodeName];Y&&Y(r,o)}var g=t,V=g.nodeType,Z=i.nodeType;if(!q){if(V===L)Z===L?k(t,i)||(m(t),g=Te(t,pe(i.nodeName,i.namespaceURI))):g=i;else if(V===te||V===ie){if(Z===V)return g.nodeValue!==i.nodeValue&&(g.nodeValue=i.nodeValue),g;g=i}}if(g===i)m(t);else{if(i.isSameNode&&i.isSameNode(g))return;if(B(g,i,q),M)for(var F=0,re=M.length;F<re;F++){var K=_[M[F]];K&&U(K,K.parentNode,!1)}}return!q&&g!==t&&t.parentNode&&(g.actualize&&(g=g.actualize(t.ownerDocument||w)),t.parentNode.replaceChild(g,t)),g}}var me=we(de);const b={INITIALIZE:"initialize",MOVE_SECTION_UP:"section:move-up",MOVE_SECTION_DOWN:"section:move-down",EDIT_SECTION:"section:edit",TOGGLE_SECTION:"section:toggle",REMOVE_SECTION:"section:remove",SET_USED_COLORS:"usedColors"},h={prefix:"visual:",EDITOR_INITIALIZED:"editor:init",SETTING_UPDATED:"setting:updated",SECTION_HIGHLIGHT:"section:highlight",SECTION_UNHIGHLIGHT:"section:unhighlight",SECTION_SELECT:"section:select",SECTION_DESELECT:"section:deselect",SECTION_LOAD:"section:load",SECTION_UNLOAD:"section:unload",BLOCK_SELECT:"block:select",BLOCK_DESELECT:"block:deselect",SECTION_ADDED:"section:added",SECTION_REMOVED:"section:removed",SECTIONS_REORDERED:"sectionsOrder",REFRESH_PREVIEW:"refresh",REORDERING:"reordering"};class Oe{constructor(){T(this,"inDesignMode",!0);T(this,"inPreviewMode",!1)}on(e,t){const i=e.startsWith(h.prefix)?e:h.prefix+e,n=a=>t(a.detail);return document.addEventListener(i,n),()=>document.removeEventListener(i,n)}_dispatch(e,t){const i=h.prefix+e;document.dispatchEvent(new CustomEvent(i,{detail:t,bubbles:!0}))}handleLiveUpdate(e,t){this.on(h.SETTING_UPDATED,({data:i,skipRefresh:n})=>{var O;const{section:a,block:c,settingId:f,settingValue:E}=i;if(!a||a.type!==e)return;const v=document.querySelector(`[data-section-id="${a.id}"]`);if(!v)return;let d;if(c&&((O=t.blocks)!=null&&O[c.type])?d=t.blocks[c.type][f]:t.section&&(d=t.section[f]),!d)return;const p=d.target?v.querySelector(d.target):null;if(!p)return;const m=typeof d.transform=="function"?d.transform(E):E;if(typeof d.handler=="function")d.handler(p,m);else if(d.html)p.innerHTML=m;else if(d.text)p.textContent=m;else if(d.style)p.style[d.style]=m;else if(d.attr)p.setAttribute(d.attr,m);else return;n()})}}window.Visual=new Oe;class Ie{constructor(){T(this,"sectionOverlay");T(this,"sectionLabel");T(this,"moveUpBtn");T(this,"moveDownBtn");T(this,"editBtn");T(this,"disableBtn");T(this,"removeBtn");T(this,"buttonsContainer");T(this,"activeSectionId",null);T(this,"sectionsOrder",[]);T(this,"hoverDebounce",0);T(this,"reorderingSectionId",null);T(this,"discardLivewireComponentNotFoundError",!1);T(this,"messageHandlers",{[h.SECTION_HIGHLIGHT]:e=>this.handleSectionHighlight(e),[h.SECTION_SELECT]:e=>this.handleSectionSelected(e),[h.SECTION_DESELECT]:e=>this.handleSectionDeselected(e),[h.BLOCK_SELECT]:e=>this.handleBlockSelected(e),[h.BLOCK_DESELECT]:e=>this.handleBlockDeselected(e),[h.SECTION_ADDED]:e=>this.handleSectionAdded(e),[h.SECTION_REMOVED]:e=>this.handleSectionRemoved(e),[h.SECTION_UNHIGHLIGHT]:()=>this.handleUnhighlightSection(),[h.SECTIONS_REORDERED]:e=>this.handleSectionsReordered(e),[h.REORDERING]:e=>this.handleReordering(e),[h.REFRESH_PREVIEW]:e=>this.refreshPreviewer(e),[h.SETTING_UPDATED]:(e,t)=>this.handleSettingUpdated(e,t)})}init(){this.initializeUIElements(),this.attachButtonEvents(),this.attachMouseEvents(),this.postMessage(b.INITIALIZE,{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema,preloadedModels:window.preloadedModels}),this.sectionsOrder=window.themeData.sectionsOrder,window.addEventListener("message",({data:e})=>this.handleMessage(e)),window.addEventListener("resize",()=>this.handleWindowResize()),this.extractUsedColors(),window.addEventListener("error",e=>{this.discardLivewireComponentNotFoundError&&e.message==="Uncaught Could not find Livewire component in DOM tree"&&e.preventDefault()})}initializeUIElements(){this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),this.buttonsContainer=document.querySelector("#buttons"),this.moveUpBtn=this.sectionOverlay.querySelector("#move-up"),this.moveDownBtn=this.sectionOverlay.querySelector("#move-down"),this.editBtn=this.sectionOverlay.querySelector("#edit"),this.disableBtn=this.sectionOverlay.querySelector("#disable"),this.removeBtn=this.sectionOverlay.querySelector("#remove")}attachButtonEvents(){this.moveUpBtn.onclick=()=>this.postMessage(b.MOVE_SECTION_UP,this.activeSectionId),this.moveDownBtn.onclick=()=>this.postMessage(b.MOVE_SECTION_DOWN,this.activeSectionId),this.editBtn.onclick=()=>this.postMessage(b.EDIT_SECTION,this.activeSectionId),this.disableBtn.onclick=()=>this.postMessage(b.TOGGLE_SECTION,this.activeSectionId),this.removeBtn.onclick=()=>this.postMessage(b.REMOVE_SECTION,this.activeSectionId)}attachMouseEvents(){document.addEventListener("mouseover",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest("[data-section-type]");t&&(this.handleUnhighlightSection(),this.buttonsContainer.style.display="flex",this.debounceFocusSection(t))},{passive:!0}),document.addEventListener("mouseleave",e=>{if(!(e.target instanceof Element)){this.buttonsContainer.style.display="none",this.clearActiveSection();return}if(!e.target.closest("[data-section-type]"))return;const i=e.relatedTarget;(!i||!this.sectionOverlay.contains(i))&&(this.buttonsContainer.style.display="none",this.clearActiveSection())},{passive:!0})}handleWindowResize(){if(this.activeSectionId){const e=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);e&&this.focusOnSection(e)}}debounceFocusSection(e){clearTimeout(this.hoverDebounce),this.hoverDebounce=window.setTimeout(()=>{this.focusOnSection(e)},50)}handleMessage({type:e,data:t,messageId:i}){const n=this.messageHandlers[e];n?n(t,i):window.Visual._dispatch(e,t)}handleSectionHighlight(e){if(this.reorderingSectionId)return;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),t.setAttribute("data-visual-highlighted","true"))}handleSectionSelected(e){if(this.activeSectionId===e)return;this.activeSectionId=e;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(this.handleSectionHighlight(e),t.scrollIntoView({behavior:"smooth",block:"start"}),window.Visual._dispatch(h.SECTION_SELECT,{section:{id:e,type:t.dataset.sectionType}}),window.Visual._dispatch(h.SECTION_SELECT+`:${e}`,{}))}handleSectionDeselected(e){this.activeSectionId===e&&(this.clearActiveSection(),this.activeSectionId=null);const t=document.querySelector(`[data-section-id="${e}"]`);t&&(t.removeAttribute("data-visual-highlighted"),window.Visual._dispatch(h.SECTION_DESELECT,{section:{id:e,type:t.dataset.sectionType}}),window.Visual._dispatch(h.SECTION_DESELECT+`:${e}`,{}))}handleBlockSelected(e){this.handleSectionSelected(e.sectionId),window.Visual._dispatch(h.BLOCK_SELECT,e),window.Visual._dispatch(h.BLOCK_SELECT+`:${e.blockId}`,{})}handleBlockDeselected(e){window.Visual._dispatch(h.BLOCK_DESELECT,e),window.Visual._dispatch(h.BLOCK_DESELECT+`:${e.blockId}`,{})}handleSectionAdded({section:e}){this.handleSectionHighlight(e.id),window.Visual._dispatch(h.SECTION_ADDED,{section:e})}handleSectionRemoved(e){const t=document.querySelector(`[data-section-id="${e.id}"]`);t&&t.remove()}handleUnhighlightSection(){document.querySelectorAll("[data-visual-highlighted]").forEach(e=>{e.removeAttribute("data-visual-highlighted")})}handleSectionsReordered(e){this.sectionsOrder=e,this.reorderingSectionId=null,document.querySelectorAll("[data-reordering]").forEach(t=>{t.removeAttribute("data-reordering")})}handleReordering(e){this.reorderingSectionId=e.sectionId,e.order.forEach(i=>{const n=document.querySelector(`[data-section-id="${i}"]`);n!=null&&n.parentElement&&n.parentElement.appendChild(n)});const t=document.querySelector(`[data-section-id="${e.sectionId}"]`);t&&requestAnimationFrame(()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"}),t.dataset.reordering="true"})}handleSettingUpdated(e,t){let i=this.autoHandleLiveUpdate(e);if(i||window.Visual._dispatch(h.SETTING_UPDATED,{data:e,skipRefresh:()=>{i=!0}}),this.activeSectionId){const n=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);n&&this.focusOnSection(n)}t&&window.parent.postMessage({messageId:t,skipRefresh:i},window.origin)}focusOnSection(e){const t=e.getBoundingClientRect();window.requestAnimationFrame(()=>{Object.assign(this.sectionOverlay.style,{display:"block",width:`${t.width}px`,height:`${t.height}px`,left:`${t.left+window.scrollX}px`,top:`${t.top+window.scrollY}px`}),this.sectionLabel.textContent=e.dataset.sectionName||"";const i=this.sectionsOrder.indexOf(e.dataset.sectionId);this.moveUpBtn.style.display=i>0?"inline":"none",this.moveDownBtn.style.display=i>0&&i<this.sectionsOrder.length-1?"inline":"none"})}clearActiveSection(){this.sectionOverlay.style.display="none"}autoHandleLiveUpdate(e){const{section:t,block:i,settingId:n,settingValue:a}=e,f=`data-live-update-${[t==null?void 0:t.id,i==null?void 0:i.id,n].filter(Boolean).join(".")}`,E=`[${CSS.escape(f)}]`,v=document.querySelectorAll(E);if(!v.length)return!1;for(const d of v){const p=d.getAttribute(f),[m,O]=(p==null?void 0:p.split(/:(.+)/))??["text",void 0];switch(m){case"text":d.textContent=a;break;case"html":d.innerHTML=a;break;case"outerHTML":d.outerHTML=a;break;case"attr":if(a)d.setAttribute(O,a);else{if(d.tagName.toLowerCase()==="img"&&O==="src")return!1;d.removeAttribute(O)}break;case"style":a?d.style.setProperty(O,a):d.style.removeProperty(O);break;case"toggleClass":d.classList.toggle(O);break;default:console.warn(`Unknown live update type: ${m}`)}}return!0}patchNode(e,t){const i=this;me(e,t,{onBeforeElUpdated(n,a){var c;if(n instanceof HTMLElement&&n.hasAttribute("wire:id")){const f=n.__livewire,E=a.getAttribute("wire:snapshot"),v=JSON.parse(a.getAttribute("wire:effects"));return v.html=a.outerHTML,f.mergeNewSnapshot(E,v),i.discardLivewireComponentNotFoundError=!0,f.processEffects(v),setTimeout(()=>{i.discardLivewireComponentNotFoundError=!1}),!1}return n._x_dataStack&&typeof((c=window.Alpine)==null?void 0:c.morph)=="function"?(window.Alpine.morph(n,a,{updating(f,E,v){if(f instanceof HTMLElement&&E instanceof HTMLElement&&f.hasAttribute("wire:id"))return v()}}),!1):!0}})}refreshPreviewer({html:e,updatedSections:t}){const i=new DOMParser().parseFromString(e,"text/html");if(t.size===0?this.patchNode(document.documentElement,i.documentElement):t.forEach((n,a)=>{var E;const c=document.querySelector(`[data-section-id="${a}"]`),f=i.querySelector(`[data-section-id="${a}"]`);if(c&&f)window.Visual._dispatch(h.SECTION_UNLOAD,n),this.patchNode(c,f);else if(!c&&f){const v=document.querySelectorAll("[data-section-type]"),d=n.position??v.length,p=(E=v[0])==null?void 0:E.parentNode;if(!p)return;d<=0?p.insertBefore(f,v[0]):d>=v.length?p.appendChild(f):p.insertBefore(f,v[d])}else return;window.Visual._dispatch(h.SECTION_LOAD,n)}),this.activeSectionId){const n=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);n&&this.focusOnSection(n)}}postMessage(e,t){window.parent.postMessage({type:e,data:t},window.origin)}extractUsedColors(e=6){const t=new Map;document.querySelectorAll("*").forEach(n=>{const a=getComputedStyle(n);[a.backgroundColor,a.color].forEach(c=>{c&&c!=="transparent"&&c!=="rgba(0, 0, 0, 0)"&&t.set(c,(t.get(c)||0)+1)})});const i=Array.from(t.entries()).sort((n,a)=>a[1]-n[1]).slice(0,e).map(([n])=>n);this.postMessage(b.SET_USED_COLORS,i)}}window.addEventListener("DOMContentLoaded",()=>{new Ie().init(),document.dispatchEvent(new CustomEvent(h.prefix+h.EDITOR_INITIALIZED,{bubbles:!0}))});
