var oe=Object.defineProperty;var ce=(r,e,t)=>e in r?oe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var g=(r,e,t)=>ce(r,typeof e!="symbol"?e+"":e,t);var J=11;function de(r,e){var t=e.attributes,i,n,s,c,u;if(!(e.nodeType===J||r.nodeType===J)){for(var p=t.length-1;p>=0;p--)i=t[p],n=i.name,s=i.namespaceURI,c=i.value,s?(n=i.localName||n,u=r.getAttributeNS(s,n),u!==c&&(i.prefix==="xmlns"&&(n=i.name),r.setAttributeNS(s,n,c))):(u=r.getAttribute(n),u!==c&&r.setAttribute(n,c));for(var f=r.attributes,d=f.length-1;d>=0;d--)i=f[d],n=i.name,s=i.namespaceURI,s?(n=i.localName||n,e.hasAttributeNS(s,n)||r.removeAttributeNS(s,n)):e.hasAttribute(n)||r.removeAttribute(n)}}var $,le="http://www.w3.org/1999/xhtml",T=typeof document>"u"?void 0:document,he=!!T&&"content"in T.createElement("template"),ue=!!T&&T.createRange&&"createContextualFragment"in T.createRange();function fe(r){var e=T.createElement("template");return e.innerHTML=r,e.content.childNodes[0]}function ve(r){$||($=T.createRange(),$.selectNode(T.body));var e=$.createContextualFragment(r);return e.childNodes[0]}function Se(r){var e=T.createElement("body");return e.innerHTML=r,e.childNodes[0]}function pe(r){return r=r.trim(),he?fe(r):ue?ve(r):Se(r)}function k(r,e){var t=r.nodeName,i=e.nodeName,n,s;return t===i?!0:(n=t.charCodeAt(0),s=i.charCodeAt(0),n<=90&&s>=97?t===i.toUpperCase():s<=90&&n>=97?i===t.toUpperCase():!1)}function Ee(r,e){return!e||e===le?T.createElement(r):T.createElementNS(e,r)}function ge(r,e){for(var t=r.firstChild;t;){var i=t.nextSibling;e.appendChild(t),t=i}return e}function W(r,e,t){r[t]!==e[t]&&(r[t]=e[t],r[t]?r.setAttribute(t,""):r.removeAttribute(t))}var Q={OPTION:function(r,e){var t=r.parentNode;if(t){var i=t.nodeName.toUpperCase();i==="OPTGROUP"&&(t=t.parentNode,i=t&&t.nodeName.toUpperCase()),i==="SELECT"&&!t.hasAttribute("multiple")&&(r.hasAttribute("selected")&&!e.selected&&(r.setAttribute("selected","selected"),r.removeAttribute("selected")),t.selectedIndex=-1)}W(r,e,"selected")},INPUT:function(r,e){W(r,e,"checked"),W(r,e,"disabled"),r.value!==e.value&&(r.value=e.value),e.hasAttribute("value")||r.removeAttribute("value")},TEXTAREA:function(r,e){var t=e.value;r.value!==t&&(r.value=t);var i=r.firstChild;if(i){var n=i.nodeValue;if(n==t||!t&&n==r.placeholder)return;i.nodeValue=t}},SELECT:function(r,e){if(!e.hasAttribute("multiple")){for(var t=-1,i=0,n=r.firstChild,s,c;n;)if(c=n.nodeName&&n.nodeName.toUpperCase(),c==="OPTGROUP")s=n,n=s.firstChild;else{if(c==="OPTION"){if(n.hasAttribute("selected")){t=i;break}i++}n=n.nextSibling,!n&&s&&(n=s.nextSibling,s=null)}r.selectedIndex=t}}},L=1,ee=11,te=3,ie=8;function A(){}function me(r){if(r)return r.getAttribute&&r.getAttribute("id")||r.id}function Te(r){return function(t,i,n){if(n||(n={}),typeof i=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var s=i;i=T.createElement("html"),i.innerHTML=s}else i=pe(i);else i.nodeType===ee&&(i=i.firstElementChild);var c=n.getNodeKey||me,u=n.onBeforeNodeAdded||A,p=n.onNodeAdded||A,f=n.onBeforeElUpdated||A,d=n.onElUpdated||A,E=n.onBeforeNodeDiscarded||A,w=n.onNodeDiscarded||A,O=n.onBeforeElChildrenUpdated||A,ne=n.skipFromChildren||A,X=n.addChild||function(a,o){return a.appendChild(o)},q=n.childrenOnly===!0,N=Object.create(null),M=[];function R(a){M.push(a)}function j(a,o){if(a.nodeType===L)for(var v=a.firstChild;v;){var l=void 0;o&&(l=c(v))?R(l):(w(v),v.firstChild&&j(v,o)),v=v.nextSibling}}function U(a,o,v){E(a)!==!1&&(o&&o.removeChild(a),w(a),j(a,v))}function P(a){if(a.nodeType===L||a.nodeType===ee)for(var o=a.firstChild;o;){var v=c(o);v&&(N[v]=o),P(o),o=o.nextSibling}}P(t);function G(a){p(a);for(var o=a.firstChild;o;){var v=o.nextSibling,l=c(o);if(l){var h=N[l];h&&k(o,h)?(o.parentNode.replaceChild(h,o),H(h,o)):G(o)}else G(o);o=v}}function re(a,o,v){for(;o;){var l=o.nextSibling;(v=c(o))?R(v):U(o,a,!0),o=l}}function H(a,o,v){var l=c(o);if(l&&delete N[l],!v){var h=f(a,o);if(h===!1||(h instanceof HTMLElement&&(a=h,P(a)),r(a,o),d(a),O(a,o)===!1))return}a.nodeName!=="TEXTAREA"?se(a,o):Q.TEXTAREA(a,o)}function se(a,o){var v=ne(a,o),l=o.firstChild,h=a.firstChild,D,I,_,B,y;e:for(;l;){for(B=l.nextSibling,D=c(l);!v&&h;){if(_=h.nextSibling,l.isSameNode&&l.isSameNode(h)){l=B,h=_;continue e}I=c(h);var V=h.nodeType,b=void 0;if(V===l.nodeType&&(V===L?(D?D!==I&&((y=N[D])?_===y?b=!1:(a.insertBefore(y,h),I?R(I):U(h,a,!0),h=y,I=c(h)):b=!1):I&&(b=!1),b=b!==!1&&k(h,l),b&&H(h,l)):(V===te||V==ie)&&(b=!0,h.nodeValue!==l.nodeValue&&(h.nodeValue=l.nodeValue))),b){l=B,h=_;continue e}I?R(I):U(h,a,!0),h=_}if(D&&(y=N[D])&&k(y,l))v||X(a,y),H(y,l);else{var K=u(l);K!==!1&&(K&&(l=K),l.actualize&&(l=l.actualize(a.ownerDocument||T)),X(a,l),G(l))}l=B,h=_}re(a,h,I);var Y=Q[a.nodeName];Y&&Y(a,o)}var m=t,x=m.nodeType,Z=i.nodeType;if(!q){if(x===L)Z===L?k(t,i)||(w(t),m=ge(t,Ee(i.nodeName,i.namespaceURI))):m=i;else if(x===te||x===ie){if(Z===x)return m.nodeValue!==i.nodeValue&&(m.nodeValue=i.nodeValue),m;m=i}}if(m===i)w(t);else{if(i.isSameNode&&i.isSameNode(m))return;if(H(m,i,q),M)for(var F=0,ae=M.length;F<ae;F++){var z=N[M[F]];z&&U(z,z.parentNode,!1)}}return!q&&m!==t&&t.parentNode&&(m.actualize&&(m=m.actualize(t.ownerDocument||T)),t.parentNode.replaceChild(m,t)),m}}var we=Te(de);const C={INITIALIZE:"initialize",MOVE_SECTION_UP:"section:move-up",MOVE_SECTION_DOWN:"section:move-down",EDIT_SECTION:"section:edit",TOGGLE_SECTION:"section:toggle",REMOVE_SECTION:"section:remove",SET_USED_COLORS:"usedColors"},S={prefix:"visual:",EDITOR_INITIALIZED:"editor:init",SETTING_UPDATED:"setting:updated",SECTION_HIGHLIGHT:"section:highlight",SECTION_UNHIGHLIGHT:"section:unhighlight",SECTION_SELECTED:"section:selected",BLOCK_SELECTED:"block:selected",SECTION_ADDED:"section:added",SECTION_REMOVED:"section:removed",SECTIONS_REORDERED:"sectionsOrder",REFRESH_PREVIEW:"refresh",REORDERING:"reordering"};class Oe{constructor(){g(this,"inDesignMode",!0);g(this,"inPreviewMode",!1)}on(e,t){const i=e.startsWith(S.prefix)?e:S.prefix+e,n=s=>t(s.detail);return document.addEventListener(i,n),()=>document.removeEventListener(i,n)}_dispatch(e,t){const i=S.prefix+e;document.dispatchEvent(new CustomEvent(i,{detail:t,bubbles:!0}))}handleLiveUpdate(e,t){this.on(S.SETTING_UPDATED,({data:i,skipRefresh:n})=>{var O;const{section:s,block:c,settingId:u,settingValue:p}=i;if(!s||s.type!==e)return;const f=document.querySelector(`[data-section-id="${s.id}"]`);if(!f)return;let d;if(c&&((O=t.blocks)!=null&&O[c.type])?d=t.blocks[c.type][u]:t.section&&(d=t.section[u]),!d)return;const E=d.target?f.querySelector(d.target):null;if(!E)return;const w=typeof d.transform=="function"?d.transform(p):p;typeof d.handler=="function"?d.handler(E,w):d.html?E.innerHTML=w:d.text?E.textContent=w:d.style?E.style[d.style]=w:d.attr&&E.setAttribute(d.attr,w),n()})}}window.Visual=new Oe;class Ie{constructor(){g(this,"sectionOverlay");g(this,"sectionLabel");g(this,"moveUpBtn");g(this,"moveDownBtn");g(this,"editBtn");g(this,"disableBtn");g(this,"removeBtn");g(this,"buttonsContainer");g(this,"activeSectionId",null);g(this,"sectionsOrder",[]);g(this,"hoverDebounce",0);g(this,"reorderingSectionId",null);g(this,"discardLivewireComponentNotFoundError",!1);g(this,"messageHandlers",{[S.SECTION_HIGHLIGHT]:e=>this.handleSectionHighlight(e),[S.SECTION_SELECTED]:e=>this.handleSectionSelected(e),[S.BLOCK_SELECTED]:e=>this.handleBlockSelected(e),[S.SECTION_ADDED]:e=>this.handleSectionAdded(e),[S.SECTION_REMOVED]:e=>this.handleSectionRemoved(e),[S.SECTION_UNHIGHLIGHT]:()=>this.handleUnhighlightSection(),[S.SECTIONS_REORDERED]:e=>this.handleSectionsReordered(e),[S.REORDERING]:e=>this.handleReordering(e),[S.REFRESH_PREVIEW]:e=>this.refreshPreviewer(e),[S.SETTING_UPDATED]:(e,t)=>this.handleSettingUpdated(e,t)})}init(){this.initializeUIElements(),this.attachButtonEvents(),this.attachMouseEvents(),this.postMessage(C.INITIALIZE,{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema,preloadedModels:window.preloadedModels}),this.sectionsOrder=window.themeData.sectionsOrder,window.addEventListener("message",({data:e})=>this.handleMessage(e)),window.addEventListener("resize",()=>this.handleWindowResize()),this.extractUsedColors(),window.addEventListener("error",e=>{this.discardLivewireComponentNotFoundError&&e.message==="Uncaught Could not find Livewire component in DOM tree"&&e.preventDefault()})}initializeUIElements(){this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),this.buttonsContainer=document.querySelector("#buttons"),this.moveUpBtn=this.sectionOverlay.querySelector("#move-up"),this.moveDownBtn=this.sectionOverlay.querySelector("#move-down"),this.editBtn=this.sectionOverlay.querySelector("#edit"),this.disableBtn=this.sectionOverlay.querySelector("#disable"),this.removeBtn=this.sectionOverlay.querySelector("#remove")}attachButtonEvents(){this.moveUpBtn.onclick=()=>this.postMessage(C.MOVE_SECTION_UP,this.activeSectionId),this.moveDownBtn.onclick=()=>this.postMessage(C.MOVE_SECTION_DOWN,this.activeSectionId),this.editBtn.onclick=()=>this.postMessage(C.EDIT_SECTION,this.activeSectionId),this.disableBtn.onclick=()=>this.postMessage(C.TOGGLE_SECTION,this.activeSectionId),this.removeBtn.onclick=()=>this.postMessage(C.REMOVE_SECTION,this.activeSectionId)}attachMouseEvents(){document.addEventListener("mouseover",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest("[data-section-type]");t&&(this.handleUnhighlightSection(),this.buttonsContainer.style.display="flex",this.debounceFocusSection(t))},{passive:!0}),document.addEventListener("mouseleave",e=>{if(!(e.target instanceof Element)){this.buttonsContainer.style.display="none",this.clearActiveSection();return}if(!e.target.closest("[data-section-type]"))return;const i=e.relatedTarget;(!i||!this.sectionOverlay.contains(i))&&(this.buttonsContainer.style.display="none",this.clearActiveSection())},{passive:!0})}handleWindowResize(){if(this.activeSectionId){const e=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);e&&this.focusOnSection(e)}}debounceFocusSection(e){clearTimeout(this.hoverDebounce),this.hoverDebounce=window.setTimeout(()=>{this.focusOnSection(e)},50)}handleMessage({type:e,data:t,messageId:i}){const n=this.messageHandlers[e];n?n(t,i):window.Visual._dispatch(e,t)}handleSectionHighlight(e){if(this.reorderingSectionId)return;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),t.setAttribute("data-visual-highlighted","true"))}handleSectionSelected(e){if(this.activeSectionId===e)return;this.activeSectionId=e;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(this.handleSectionHighlight(e),t.scrollIntoView({behavior:"smooth",block:"start"}),window.Visual._dispatch(S.SECTION_SELECTED,{section:{id:t.dataset.sectionId,type:t.dataset.sectionType}}))}handleBlockSelected(e){this.handleSectionSelected(e.sectionId),window.Visual._dispatch(S.BLOCK_SELECTED,e)}handleSectionAdded({section:e}){this.handleSectionHighlight(e.id),window.Visual._dispatch(S.SECTION_ADDED,{section:e})}handleSectionRemoved(e){const t=document.querySelector(`[data-section-id="${e.id}"]`);t&&t.remove()}handleUnhighlightSection(){document.querySelectorAll("[data-visual-highlighted]").forEach(e=>{e.removeAttribute("data-visual-highlighted")})}handleSectionsReordered(e){this.sectionsOrder=e,this.reorderingSectionId=null,document.querySelectorAll("[data-reordering]").forEach(t=>{t.removeAttribute("data-reordering")})}handleReordering(e){this.reorderingSectionId=e.sectionId,e.order.forEach(i=>{const n=document.querySelector(`[data-section-id="${i}"]`);n!=null&&n.parentElement&&n.parentElement.appendChild(n)});const t=document.querySelector(`[data-section-id="${e.sectionId}"]`);t&&requestAnimationFrame(()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"}),t.dataset.reordering="true"})}handleSettingUpdated(e,t){let i=this.autoHandleLiveUpdate(e);if(i||window.Visual._dispatch(S.SETTING_UPDATED,{data:e,skipRefresh:()=>{i=!0}}),this.activeSectionId){const n=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);n&&(this.focusOnSection(n),n.scrollIntoView({behavior:"smooth",block:"start"}))}t&&window.parent.postMessage({messageId:t,skipRefresh:i},window.origin)}focusOnSection(e){const t=e.getBoundingClientRect();window.requestAnimationFrame(()=>{Object.assign(this.sectionOverlay.style,{display:"block",width:`${t.width}px`,height:`${t.height}px`,left:`${t.left+window.scrollX}px`,top:`${t.top+window.scrollY}px`}),this.sectionLabel.textContent=e.dataset.sectionName||"";const i=this.sectionsOrder.indexOf(e.dataset.sectionId);this.moveUpBtn.style.display=i>0?"inline":"none",this.moveDownBtn.style.display=i>0&&i<this.sectionsOrder.length-1?"inline":"none"})}clearActiveSection(){this.sectionOverlay.style.display="none"}autoHandleLiveUpdate(e){const{section:t,block:i,settingId:n,settingValue:s}=e,u=`data-live-update-${[t==null?void 0:t.id,i==null?void 0:i.id,n].filter(Boolean).join(".")}`,p=`[${CSS.escape(u)}]`,f=document.querySelectorAll(p);return f.length?(f.forEach(d=>{const E=d.getAttribute(u),[w,O]=(E==null?void 0:E.split(":"))??["text",void 0];switch(w){case"text":d.textContent=s;break;case"html":d.innerHTML=s;break;case"outerHTML":d.outerHTML=s;break;case"attr":s?d.setAttribute(O,s):d.removeAttribute(O);break;case"style":s?d.style.setProperty(O,s):d.style.removeProperty(O);break;default:console.warn(`Unknown live update type: ${w}`)}}),!0):!1}patchNode(e,t){const i=this;we(e,t,{onBeforeElUpdated(n,s){var c;if(n instanceof HTMLElement&&n.hasAttribute("wire:id")){const u=n.__livewire,p=s.getAttribute("wire:snapshot"),f=JSON.parse(s.getAttribute("wire:effects"));return f.html=s.outerHTML,u.mergeNewSnapshot(p,f),i.discardLivewireComponentNotFoundError=!0,u.processEffects(f),setTimeout(()=>{i.discardLivewireComponentNotFoundError=!1}),!1}return n._x_dataStack&&typeof((c=window.Alpine)==null?void 0:c.morph)=="function"?(window.Alpine.morph(n,s,{updating(u,p,f){if(u instanceof HTMLElement&&p instanceof HTMLElement&&u.hasAttribute("wire:id"))return f()}}),!1):!0}})}refreshPreviewer({html:e,updatedSections:t}){const i=new DOMParser().parseFromString(e,"text/html");if(t.size===0?this.patchNode(document.documentElement,i.documentElement):t.forEach((n,s)=>{var p;const c=document.querySelector(`[data-section-id="${s}"]`),u=i.querySelector(`[data-section-id="${s}"]`);if(c&&u)this.patchNode(c,u);else if(!c&&u){const f=document.querySelectorAll("[data-section-type]"),d=n.position??f.length,E=(p=f[0])==null?void 0:p.parentNode;if(!E)return;d<=0?E.insertBefore(u,f[0]):d>=f.length?E.appendChild(u):E.insertBefore(u,f[d])}else return;window.Visual._dispatch("section:updated",n)}),this.activeSectionId){const n=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);n&&this.focusOnSection(n)}}postMessage(e,t){window.parent.postMessage({type:e,data:t},window.origin)}extractUsedColors(e=6){const t=new Map;document.querySelectorAll("*").forEach(n=>{const s=getComputedStyle(n);[s.backgroundColor,s.color].forEach(c=>{c&&c!=="transparent"&&c!=="rgba(0, 0, 0, 0)"&&t.set(c,(t.get(c)||0)+1)})});const i=Array.from(t.entries()).sort((n,s)=>s[1]-n[1]).slice(0,e).map(([n])=>n);this.postMessage(C.SET_USED_COLORS,i)}}window.addEventListener("DOMContentLoaded",()=>{new Ie().init(),document.dispatchEvent(new CustomEvent(S.prefix+S.EDITOR_INITIALIZED,{bubbles:!0}))});
