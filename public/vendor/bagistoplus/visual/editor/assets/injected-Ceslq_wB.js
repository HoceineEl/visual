var ce=Object.defineProperty;var de=(a,e,t)=>e in a?ce(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var m=(a,e,t)=>de(a,typeof e!="symbol"?e+"":e,t);var Q=11;function le(a,e){var t=e.attributes,i,n,s,o,u;if(!(e.nodeType===Q||a.nodeType===Q)){for(var v=t.length-1;v>=0;v--)i=t[v],n=i.name,s=i.namespaceURI,o=i.value,s?(n=i.localName||n,u=a.getAttributeNS(s,n),u!==o&&(i.prefix==="xmlns"&&(n=i.name),a.setAttributeNS(s,n,o))):(u=a.getAttribute(n),u!==o&&a.setAttribute(n,o));for(var S=a.attributes,r=S.length-1;r>=0;r--)i=S[r],n=i.name,s=i.namespaceURI,s?(n=i.localName||n,e.hasAttributeNS(s,n)||a.removeAttributeNS(s,n)):e.hasAttribute(n)||a.removeAttribute(n)}}var k,ue="http://www.w3.org/1999/xhtml",O=typeof document>"u"?void 0:document,he=!!O&&"content"in O.createElement("template"),fe=!!O&&O.createRange&&"createContextualFragment"in O.createRange();function ve(a){var e=O.createElement("template");return e.innerHTML=a,e.content.childNodes[0]}function Se(a){k||(k=O.createRange(),k.selectNode(O.body));var e=k.createContextualFragment(a);return e.childNodes[0]}function pe(a){var e=O.createElement("body");return e.innerHTML=a,e.childNodes[0]}function Ee(a){return a=a.trim(),he?ve(a):fe?Se(a):pe(a)}function q(a,e){var t=a.nodeName,i=e.nodeName,n,s;return t===i?!0:(n=t.charCodeAt(0),s=i.charCodeAt(0),n<=90&&s>=97?t===i.toUpperCase():s<=90&&n>=97?i===t.toUpperCase():!1)}function Te(a,e){return!e||e===ue?O.createElement(a):O.createElementNS(e,a)}function me(a,e){for(var t=a.firstChild;t;){var i=t.nextSibling;e.appendChild(t),t=i}return e}function X(a,e,t){a[t]!==e[t]&&(a[t]=e[t],a[t]?a.setAttribute(t,""):a.removeAttribute(t))}var ee={OPTION:function(a,e){var t=a.parentNode;if(t){var i=t.nodeName.toUpperCase();i==="OPTGROUP"&&(t=t.parentNode,i=t&&t.nodeName.toUpperCase()),i==="SELECT"&&!t.hasAttribute("multiple")&&(a.hasAttribute("selected")&&!e.selected&&(a.setAttribute("selected","selected"),a.removeAttribute("selected")),t.selectedIndex=-1)}X(a,e,"selected")},INPUT:function(a,e){X(a,e,"checked"),X(a,e,"disabled"),a.value!==e.value&&(a.value=e.value),e.hasAttribute("value")||a.removeAttribute("value")},TEXTAREA:function(a,e){var t=e.value;a.value!==t&&(a.value=t);var i=a.firstChild;if(i){var n=i.nodeValue;if(n==t||!t&&n==a.placeholder)return;i.nodeValue=t}},SELECT:function(a,e){if(!e.hasAttribute("multiple")){for(var t=-1,i=0,n=a.firstChild,s,o;n;)if(o=n.nodeName&&n.nodeName.toUpperCase(),o==="OPTGROUP")s=n,n=s.firstChild;else{if(o==="OPTION"){if(n.hasAttribute("selected")){t=i;break}i++}n=n.nextSibling,!n&&s&&(n=s.nextSibling,s=null)}a.selectedIndex=t}}},M=1,te=11,ie=3,ne=8;function N(){}function ge(a){if(a)return a.getAttribute&&a.getAttribute("id")||a.id}function we(a){return function(t,i,n){if(n||(n={}),typeof i=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var s=i;i=O.createElement("html"),i.innerHTML=s}else i=Ee(i);else i.nodeType===te&&(i=i.firstElementChild);var o=n.getNodeKey||ge,u=n.onBeforeNodeAdded||N,v=n.onNodeAdded||N,S=n.onBeforeElUpdated||N,r=n.onElUpdated||N,E=n.onBeforeNodeDiscarded||N,g=n.onNodeDiscarded||N,T=n.onBeforeElChildrenUpdated||N,C=n.skipFromChildren||N,j=n.addChild||function(c,d){return c.appendChild(d)},P=n.childrenOnly===!0,_=Object.create(null),R=[];function U(c){R.push(c)}function Z(c,d){if(c.nodeType===M)for(var p=c.firstChild;p;){var l=void 0;d&&(l=o(p))?U(l):(g(p),p.firstChild&&Z(p,d)),p=p.nextSibling}}function B(c,d,p){E(c)!==!1&&(d&&d.removeChild(c),g(c),Z(c,p))}function G(c){if(c.nodeType===M||c.nodeType===te)for(var d=c.firstChild;d;){var p=o(d);p&&(_[p]=d),G(d),d=d.nextSibling}}G(t);function F(c){v(c);for(var d=c.firstChild;d;){var p=d.nextSibling,l=o(d);if(l){var f=_[l];f&&q(d,f)?(d.parentNode.replaceChild(f,d),V(f,d)):F(d)}else F(d);d=p}}function ae(c,d,p){for(;d;){var l=d.nextSibling;(p=o(d))?U(p):B(d,c,!0),d=l}}function V(c,d,p){var l=o(d);if(l&&delete _[l],!p){var f=S(c,d);if(f===!1||(f instanceof HTMLElement&&(c=f,G(c)),a(c,d),r(c),T(c,d)===!1))return}c.nodeName!=="TEXTAREA"?re(c,d):ee.TEXTAREA(c,d)}function re(c,d){var p=C(c,d),l=d.firstChild,f=c.firstChild,L,I,D,$,y;e:for(;l;){for($=l.nextSibling,L=o(l);!p&&f;){if(D=f.nextSibling,l.isSameNode&&l.isSameNode(f)){l=$,f=D;continue e}I=o(f);var x=f.nodeType,b=void 0;if(x===l.nodeType&&(x===M?(L?L!==I&&((y=_[L])?D===y?b=!1:(c.insertBefore(y,f),I?U(I):B(f,c,!0),f=y,I=o(f)):b=!1):I&&(b=!1),b=b!==!1&&q(f,l),b&&V(f,l)):(x===ie||x==ne)&&(b=!0,f.nodeValue!==l.nodeValue&&(f.nodeValue=l.nodeValue))),b){l=$,f=D;continue e}I?U(I):B(f,c,!0),f=D}if(L&&(y=_[L])&&q(y,l))p||j(c,y),V(y,l);else{var W=u(l);W!==!1&&(W&&(l=W),l.actualize&&(l=l.actualize(c.ownerDocument||O)),j(c,l),F(l))}l=$,f=D}ae(c,f,I);var J=ee[c.nodeName];J&&J(c,d)}var w=t,H=w.nodeType,Y=i.nodeType;if(!P){if(H===M)Y===M?q(t,i)||(g(t),w=me(t,Te(i.nodeName,i.namespaceURI))):w=i;else if(H===ie||H===ne){if(Y===H)return w.nodeValue!==i.nodeValue&&(w.nodeValue=i.nodeValue),w;w=i}}if(w===i)g(t);else{if(i.isSameNode&&i.isSameNode(w))return;if(V(w,i,P),R)for(var K=0,oe=R.length;K<oe;K++){var z=_[R[K]];z&&B(z,z.parentNode,!1)}}return!P&&w!==t&&t.parentNode&&(w.actualize&&(w=w.actualize(t.ownerDocument||O)),t.parentNode.replaceChild(w,t)),w}}var se=we(le);const A={INITIALIZE:"initialize",MOVE_SECTION_UP:"section:move-up",MOVE_SECTION_DOWN:"section:move-down",EDIT_SECTION:"section:edit",TOGGLE_SECTION:"section:toggle",REMOVE_SECTION:"section:remove",SET_USED_COLORS:"usedColors"},h={prefix:"visual:",EDITOR_INITIALIZED:"editor:init",SETTING_UPDATED:"setting:updated",SECTION_HIGHLIGHT:"section:highlight",SECTION_UNHIGHLIGHT:"section:unhighlight",SECTION_SELECT:"section:select",SECTION_DESELECT:"section:deselect",SECTION_LOAD:"section:load",SECTION_UNLOAD:"section:unload",BLOCK_SELECT:"block:select",BLOCK_DESELECT:"block:deselect",SECTION_ADDED:"section:added",SECTION_REMOVED:"section:removed",SECTIONS_REORDERED:"sectionsOrder",REFRESH_PREVIEW:"refresh",REORDERING:"reordering"};class Oe{constructor(){m(this,"inDesignMode",!0);m(this,"inPreviewMode",!1)}on(e,t){const i=e.startsWith(h.prefix)?e:h.prefix+e,n=s=>t(s.detail);return document.addEventListener(i,n),()=>document.removeEventListener(i,n)}_dispatch(e,t){const i=h.prefix+e;document.dispatchEvent(new CustomEvent(i,{detail:t,bubbles:!0}))}handleLiveUpdate(e,t){this.on(h.SETTING_UPDATED,({data:i,skipRefresh:n})=>{var T;const{section:s,block:o,settingId:u,settingValue:v}=i;if(!s||s.type!==e)return;const S=document.querySelector(`[data-section-id="${s.id}"]`);if(!S)return;let r;if(o&&((T=t.blocks)!=null&&T[o.type])?r=t.blocks[o.type][u]:t.section&&(r=t.section[u]),!r)return;if(typeof r=="function")return r(v),n();const E=r.target?S.querySelector(r.target):null;if(!E)return;const g=typeof r.transform=="function"?r.transform(v):v;if(typeof r.handler=="function")r.handler(E,g);else if(r.html)E.innerHTML=g;else if(r.text)E.textContent=g;else if(r.style)E.style[r.style]=g;else if(r.attr)E.setAttribute(r.attr,g);else return;n()})}}window.Visual=new Oe;class Ce{constructor(){m(this,"sectionOverlay");m(this,"sectionLabel");m(this,"moveUpBtn");m(this,"moveDownBtn");m(this,"editBtn");m(this,"disableBtn");m(this,"removeBtn");m(this,"buttonsContainer");m(this,"activeSectionId",null);m(this,"sectionsOrder",[]);m(this,"hoverDebounce",0);m(this,"reorderingSectionId",null);m(this,"sectionContainers",new Map);m(this,"discardLivewireComponentNotFoundError",!1);m(this,"messageHandlers",{[h.SECTION_HIGHLIGHT]:e=>this.handleSectionHighlight(e),[h.SECTION_SELECT]:e=>this.handleSectionSelected(e),[h.SECTION_DESELECT]:e=>this.handleSectionDeselected(e),[h.BLOCK_SELECT]:e=>this.handleBlockSelected(e),[h.BLOCK_DESELECT]:e=>this.handleBlockDeselected(e),[h.SECTION_ADDED]:e=>this.handleSectionAdded(e),[h.SECTION_REMOVED]:e=>this.handleSectionRemoved(e),[h.SECTION_UNHIGHLIGHT]:()=>this.handleUnhighlightSection(),[h.SECTIONS_REORDERED]:e=>this.handleSectionsReordered(e),[h.REORDERING]:e=>this.handleReordering(e),[h.REFRESH_PREVIEW]:e=>this.refreshPreviewer(e),[h.SETTING_UPDATED]:(e,t)=>this.handleSettingUpdated(e,t)})}init(){this.initializeUIElements(),this.attachButtonEvents(),this.attachMouseEvents(),this.postMessage(A.INITIALIZE,{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema,preloadedModels:window.preloadedModels}),this.sectionsOrder=window.themeData.sectionsOrder,this.buildSectionContainers(),window.addEventListener("message",({data:e})=>this.handleMessage(e)),window.addEventListener("resize",()=>this.handleWindowResize()),this.extractUsedColors(),window.addEventListener("error",e=>{this.discardLivewireComponentNotFoundError&&e.message==="Uncaught Could not find Livewire component in DOM tree"&&e.preventDefault()})}initializeUIElements(){this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),this.buttonsContainer=document.querySelector("#buttons"),this.moveUpBtn=this.sectionOverlay.querySelector("#move-up"),this.moveDownBtn=this.sectionOverlay.querySelector("#move-down"),this.editBtn=this.sectionOverlay.querySelector("#edit"),this.disableBtn=this.sectionOverlay.querySelector("#disable"),this.removeBtn=this.sectionOverlay.querySelector("#remove")}buildSectionContainers(){document.querySelectorAll("[data-section-id]").forEach(e=>{this.sectionContainers.set(e.dataset.sectionId,e.parentNode)})}findCommentParent(e){const i=document.createNodeIterator(document.body,NodeFilter.SHOW_COMMENT,{acceptNode(n){var s;return((s=n.nodeValue)==null?void 0:s.trim())===e?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}}).nextNode();return(i==null?void 0:i.parentNode)??null}attachButtonEvents(){this.moveUpBtn.onclick=()=>this.postMessage(A.MOVE_SECTION_UP,this.activeSectionId),this.moveDownBtn.onclick=()=>this.postMessage(A.MOVE_SECTION_DOWN,this.activeSectionId),this.editBtn.onclick=()=>this.postMessage(A.EDIT_SECTION,this.activeSectionId),this.disableBtn.onclick=()=>this.postMessage(A.TOGGLE_SECTION,this.activeSectionId),this.removeBtn.onclick=()=>this.postMessage(A.REMOVE_SECTION,this.activeSectionId)}attachMouseEvents(){document.addEventListener("mouseover",e=>{var o;const t=e.target,i=e.relatedTarget;if(!t)return;const n=t.closest("[data-section-type]"),s=(o=i==null?void 0:i.closest)==null?void 0:o.call(i,"[data-section-type]");n&&n!==s&&(this.activeSectionId=n.dataset.sectionId,this.handleUnhighlightSection(),this.buttonsContainer.style.display="flex",this.debounceFocusSection(n))},{passive:!0}),document.addEventListener("mouseout",e=>{var u,v;const t=e.target,i=e.relatedTarget,n=(u=t==null?void 0:t.closest)==null?void 0:u.call(t,"[data-section-type]"),s=(v=i==null?void 0:i.closest)==null?void 0:v.call(i,"[data-section-type]"),o=i&&this.sectionOverlay.contains(i);n&&n!==s&&!o&&(this.buttonsContainer.style.display="none",this.clearActiveSection())},{passive:!0}),document.addEventListener("mouseleave",e=>{e.relatedTarget||(this.buttonsContainer.style.display="none",this.clearActiveSection())},{passive:!0}),window.addEventListener("blur",()=>{this.buttonsContainer.style.display="none",this.clearActiveSection()})}handleWindowResize(){if(this.activeSectionId){const e=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);e&&this.focusOnSection(e)}}debounceFocusSection(e){clearTimeout(this.hoverDebounce),this.hoverDebounce=window.setTimeout(()=>{this.focusOnSection(e)},50)}handleMessage({type:e,data:t,messageId:i}){const n=this.messageHandlers[e];n?n(t,i):window.Visual._dispatch(e,t)}handleSectionHighlight(e){if(this.reorderingSectionId)return;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),t.setAttribute("data-visual-highlighted","true"))}handleSectionSelected(e){if(this.activeSectionId===e)return;this.activeSectionId=e;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(this.handleSectionHighlight(e),t.scrollIntoView({behavior:"smooth",block:"start"}),window.Visual._dispatch(h.SECTION_SELECT,{section:{id:e,type:t.dataset.sectionType}}),window.Visual._dispatch(h.SECTION_SELECT+`:${e}`,{}))}handleSectionDeselected(e){this.activeSectionId===e&&this.clearActiveSection();const t=document.querySelector(`[data-section-id="${e}"]`);t&&(t.removeAttribute("data-visual-highlighted"),window.Visual._dispatch(h.SECTION_DESELECT,{section:{id:e,type:t.dataset.sectionType}}),window.Visual._dispatch(h.SECTION_DESELECT+`:${e}`,{}))}handleBlockSelected(e){this.handleSectionSelected(e.sectionId),window.Visual._dispatch(h.BLOCK_SELECT,e),window.Visual._dispatch(h.BLOCK_SELECT+`:${e.blockId}`,{})}handleBlockDeselected(e){window.Visual._dispatch(h.BLOCK_DESELECT,e),window.Visual._dispatch(h.BLOCK_DESELECT+`:${e.blockId}`,{})}handleSectionAdded({section:e}){this.handleSectionHighlight(e.id),window.Visual._dispatch(h.SECTION_ADDED,{section:e})}handleSectionRemoved(e){const t=document.querySelector(`[data-section-id="${e.id}"]`);t&&t.remove()}handleUnhighlightSection(){document.querySelectorAll("[data-visual-highlighted]").forEach(e=>{e.removeAttribute("data-visual-highlighted")})}handleSectionsReordered(e){this.sectionsOrder=e,this.reorderingSectionId=null,setTimeout(()=>{document.querySelectorAll("[data-reordering]").forEach(t=>{t.removeAttribute("data-reordering")})},1e3)}handleReordering(e){this.reorderingSectionId=e.sectionId;const t=this.findCommentParent("BEGIN: template");e.order.forEach(n=>{const s=t.querySelector(`[data-section-id="${n}"]`);s!=null&&s.parentElement&&s.parentElement.appendChild(s)});const i=document.querySelector(`[data-section-id="${e.sectionId}"]`);i&&requestAnimationFrame(()=>{i.scrollIntoView({behavior:"smooth",block:"nearest"}),i.dataset.reordering="true",this.clearActiveSection()})}handleSettingUpdated(e,t){let i=this.autoHandleLiveUpdate(e);if(i||window.Visual._dispatch(h.SETTING_UPDATED,{data:e,skipRefresh:()=>{i=!0}}),this.activeSectionId){const n=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);n&&this.focusOnSection(n)}t&&window.parent.postMessage({messageId:t,skipRefresh:i},window.origin)}focusOnSection(e){const t=e.getBoundingClientRect();window.requestAnimationFrame(()=>{Object.assign(this.sectionOverlay.style,{display:"block",width:`${t.width}px`,height:`${t.height}px`,left:`${t.left+window.scrollX}px`,top:`${t.top+window.scrollY}px`}),this.sectionLabel.textContent=e.dataset.sectionName||"";const i=this.sectionsOrder.indexOf(e.dataset.sectionId);this.moveUpBtn.style.display=i>0?"inline":"none",this.moveDownBtn.style.display=i>=0&&i<this.sectionsOrder.length-1?"inline":"none"})}clearActiveSection(){this.activeSectionId=null,this.sectionOverlay.style.display="none"}autoHandleLiveUpdate(e){const{section:t,block:i,settingId:n,settingValue:s}=e,u=`data-live-update-${[t==null?void 0:t.id,i==null?void 0:i.id,n].filter(Boolean).join(".")}`,v=`[${CSS.escape(u)}]`,S=document.querySelectorAll(v);if(!S.length)return!1;for(const r of S){const E=r.getAttribute(u),[g,T]=(E==null?void 0:E.split(/:(.+)/))??["text",void 0];switch(g){case"text":r.textContent=s;break;case"html":r.innerHTML=s;break;case"outerHTML":r.outerHTML=s;break;case"attr":if(s)r.setAttribute(T,s);else{if(r.tagName.toLowerCase()==="img"&&T==="src")return!1;r.removeAttribute(T)}break;case"style":s?r.style.setProperty(T,s):r.style.removeProperty(T);break;case"toggleClass":r.classList.toggle(T);break;default:console.warn(`Unknown live update type: ${g}`)}}return!0}patchNode(e,t){const i=this;se(e,t,{onBeforeElUpdated(n,s){var o;if(n instanceof HTMLElement&&n.hasAttribute("wire:id")){const u=n.__livewire,v=s.getAttribute("wire:snapshot"),S=JSON.parse(s.getAttribute("wire:effects"));return S.html=s.outerHTML,u.mergeNewSnapshot(v,S),i.discardLivewireComponentNotFoundError=!0,u.processEffects(S),setTimeout(()=>{i.discardLivewireComponentNotFoundError=!1}),!1}return n._x_dataStack&&typeof((o=window.Alpine)==null?void 0:o.morph)=="function"?(window.Alpine.morph(n,s,{updating(u,v,S){if(u instanceof HTMLElement&&v instanceof HTMLElement&&u.hasAttribute("wire:id"))return S()}}),!1):!0}})}patchScripts(e,t){const i=Array.from(e.querySelectorAll("script"));Array.from(t.querySelectorAll("script")).forEach(s=>{const o=!s.src,u=document.createElement("script");Array.from(s.attributes).forEach(S=>{u.setAttribute(S.name,S.value)}),o&&(u.innerHTML=s.innerHTML);const v=s.id?e.querySelector(`script#${CSS.escape(s.id)}`):null;if(v){v.replaceWith(u);return}!o&&i.some(r=>r.src!==s.src?!1:Array.from(s.attributes).every(E=>r.getAttribute(E.name)===E.value))||e.appendChild(u)})}refreshPreviewer({html:e,updatedSections:t}){const i=new DOMParser().parseFromString(e,"text/html"),n=this.sectionContainers;if(se(document.head,i.head),t.size===0)this.patchNode(document.body,i.body),window.Visual._dispatch("page:load",{});else{const s=this.findCommentParent("BEGIN: template"),o=document.querySelectorAll("[data-section-type]");t.forEach((u,v)=>{var E;const S=document.querySelector(`[data-section-id="${v}"]`),r=i.querySelector(`[data-section-id="${v}"]`);if(S&&r)window.Visual._dispatch(h.SECTION_UNLOAD,u),this.patchNode(S,r);else if(!S&&r){const g=u.position??o.length,T=r.dataset.sectionId;if(g<=0){let C=n.get(T)??s;C.insertBefore(r,C.firstChild),n.has(T)||n.set(T,C)}else if(g>=o.length){let C=n.get(T)??s;C.appendChild(r),n.has(T)||n.set(T,C)}else{const C=o[g];(E=C.parentNode)==null||E.insertBefore(r,C)}}else return;window.Visual._dispatch(h.SECTION_LOAD,u)})}if(this.patchScripts(document.body,i.body),this.activeSectionId){const s=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);s&&this.focusOnSection(s)}}postMessage(e,t){window.parent.postMessage({type:e,data:t},window.origin)}extractUsedColors(e=6){const t=new Map;document.querySelectorAll("*").forEach(n=>{const s=getComputedStyle(n);[s.backgroundColor,s.color].forEach(o=>{o&&o!=="transparent"&&o!=="rgba(0, 0, 0, 0)"&&t.set(o,(t.get(o)||0)+1)})});const i=Array.from(t.entries()).sort((n,s)=>s[1]-n[1]).slice(0,e).map(([n])=>n);this.postMessage(A.SET_USED_COLORS,i)}}window.addEventListener("DOMContentLoaded",()=>{new Ce().init(),document.dispatchEvent(new CustomEvent(h.prefix+h.EDITOR_INITIALIZED,{bubbles:!0}))});
