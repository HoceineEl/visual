var q=Object.defineProperty;var N=(M,a,c)=>a in M?q(M,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):M[a]=c;var k=(M,a,c)=>N(M,typeof a!="symbol"?a+"":a,c);var D=function(){const M=()=>{},a={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:M,afterNodeAdded:M,beforeNodeMorphed:M,afterNodeMorphed:M,beforeNodeRemoved:M,afterNodeRemoved:M,beforeAttributeUpdated:M},head:{style:"merge",shouldPreserve:l=>l.getAttribute("im-preserve")==="true",shouldReAppend:l=>l.getAttribute("im-re-append")==="true",shouldRemove:M,afterHeadMorphed:M},restoreFocus:!0};function c(l,v,d={}){l=A(l);const f=L(v),p=H(l,f,d),u=w(p,()=>B(p,l,f,i=>i.morphStyle==="innerHTML"?(y(i,l,f),Array.from(l.childNodes)):m(i,l,f)));return p.pantry.remove(),u}function m(l,v,d){const f=L(v);return y(l,f,d,v,v.nextSibling),Array.from(f.childNodes)}function w(l,v){var n;if(!l.config.restoreFocus)return v();let d=document.activeElement;if(!(d instanceof HTMLInputElement||d instanceof HTMLTextAreaElement))return v();const{id:f,selectionStart:p,selectionEnd:u}=d,i=v();return f&&f!==((n=document.activeElement)==null?void 0:n.id)&&(d=l.target.querySelector(`[id="${f}"]`),d==null||d.focus()),d&&!d.selectionEnd&&u&&d.setSelectionRange(p,u),i}const y=function(){function l(e,t,r,s=null,o=null){t instanceof HTMLTemplateElement&&r instanceof HTMLTemplateElement&&(t=t.content,r=r.content),s||(s=t.firstChild);for(const h of r.childNodes){if(s&&s!=o){const g=d(e,h,s,o);if(g){g!==s&&p(e,s,g),I(g,h,e),s=g.nextSibling;continue}}if(h instanceof Element&&e.persistentIds.has(h.id)){const g=u(t,h.id,s,e);I(g,h,e),s=g.nextSibling;continue}const b=v(t,h,s,e);b&&(s=b.nextSibling)}for(;s&&s!=o;){const h=s;s=s.nextSibling,f(e,h)}}function v(e,t,r,s){if(s.callbacks.beforeNodeAdded(t)===!1)return null;if(s.idMap.has(t)){const o=document.createElement(t.tagName);return e.insertBefore(o,r),I(o,t,s),s.callbacks.afterNodeAdded(o),o}else{const o=document.importNode(t,!0);return e.insertBefore(o,r),s.callbacks.afterNodeAdded(o),o}}const d=function(){function e(s,o,h,b){let g=null,T=o.nextSibling,V=0,O=h;for(;O&&O!=b;){if(r(O,o)){if(t(s,O,o))return O;g===null&&(s.idMap.has(O)||(g=O))}if(g===null&&T&&r(O,T)&&(V++,T=T.nextSibling,V>=2&&(g=void 0)),O.contains(document.activeElement))break;O=O.nextSibling}return g||null}function t(s,o,h){let b=s.idMap.get(o),g=s.idMap.get(h);if(!g||!b)return!1;for(const T of b)if(g.has(T))return!0;return!1}function r(s,o){const h=s,b=o;return h.nodeType===b.nodeType&&h.tagName===b.tagName&&(!h.id||h.id===b.id)}return e}();function f(e,t){var r;if(e.idMap.has(t))n(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;(r=t.parentNode)==null||r.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function p(e,t,r){let s=t;for(;s&&s!==r;){let o=s;s=s.nextSibling,f(e,o)}return s}function u(e,t,r,s){const o=s.target.id===t&&s.target||s.target.querySelector(`[id="${t}"]`)||s.pantry.querySelector(`[id="${t}"]`);return i(o,s),n(e,o,r),o}function i(e,t){const r=e.id;for(;e=e.parentNode;){let s=t.idMap.get(e);s&&(s.delete(r),s.size||t.idMap.delete(e))}}function n(e,t,r){if(e.moveBefore)try{e.moveBefore(t,r)}catch{e.insertBefore(t,r)}else e.insertBefore(t,r)}return l}(),I=function(){function l(i,n,e){return e.ignoreActive&&i===document.activeElement?null:(e.callbacks.beforeNodeMorphed(i,n)===!1||(i instanceof HTMLHeadElement&&e.head.ignore||(i instanceof HTMLHeadElement&&e.head.style!=="morph"?E(i,n,e):(v(i,n,e),u(i,e)||y(e,i,n))),e.callbacks.afterNodeMorphed(i,n)),i)}function v(i,n,e){let t=n.nodeType;if(t===1){const r=i,s=n,o=r.attributes,h=s.attributes;for(const b of h)p(b.name,r,"update",e)||r.getAttribute(b.name)!==b.value&&r.setAttribute(b.name,b.value);for(let b=o.length-1;0<=b;b--){const g=o[b];if(g&&!s.hasAttribute(g.name)){if(p(g.name,r,"remove",e))continue;r.removeAttribute(g.name)}}u(r,e)||d(r,s,e)}(t===8||t===3)&&i.nodeValue!==n.nodeValue&&(i.nodeValue=n.nodeValue)}function d(i,n,e){if(i instanceof HTMLInputElement&&n instanceof HTMLInputElement&&n.type!=="file"){let t=n.value,r=i.value;f(i,n,"checked",e),f(i,n,"disabled",e),n.hasAttribute("value")?r!==t&&(p("value",i,"update",e)||(i.setAttribute("value",t),i.value=t)):p("value",i,"remove",e)||(i.value="",i.removeAttribute("value"))}else if(i instanceof HTMLOptionElement&&n instanceof HTMLOptionElement)f(i,n,"selected",e);else if(i instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement){let t=n.value,r=i.value;if(p("value",i,"update",e))return;t!==r&&(i.value=t),i.firstChild&&i.firstChild.nodeValue!==t&&(i.firstChild.nodeValue=t)}}function f(i,n,e,t){const r=n[e],s=i[e];if(r!==s){const o=p(e,i,"update",t);o||(i[e]=n[e]),r?o||i.setAttribute(e,""):p(e,i,"remove",t)||i.removeAttribute(e)}}function p(i,n,e,t){return i==="value"&&t.ignoreActiveValue&&n===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(i,n,e)===!1}function u(i,n){return!!n.ignoreActiveValue&&i===document.activeElement&&i!==document.body}return l}();function B(l,v,d,f){if(l.head.block){const p=v.querySelector("head"),u=d.querySelector("head");if(p&&u){const i=E(p,u,l);return Promise.all(i).then(()=>{const n=Object.assign(l,{head:{block:!1,ignore:!0}});return f(n)})}}return f(l)}function E(l,v,d){let f=[],p=[],u=[],i=[],n=new Map;for(const t of v.children)n.set(t.outerHTML,t);for(const t of l.children){let r=n.has(t.outerHTML),s=d.head.shouldReAppend(t),o=d.head.shouldPreserve(t);r||o?s?p.push(t):(n.delete(t.outerHTML),u.push(t)):d.head.style==="append"?s&&(p.push(t),i.push(t)):d.head.shouldRemove(t)!==!1&&p.push(t)}i.push(...n.values());let e=[];for(const t of i){let r=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(d.callbacks.beforeNodeAdded(r)!==!1){if("href"in r&&r.href||"src"in r&&r.src){let s,o=new Promise(function(h){s=h});r.addEventListener("load",function(){s()}),e.push(o)}l.appendChild(r),d.callbacks.afterNodeAdded(r),f.push(r)}}for(const t of p)d.callbacks.beforeNodeRemoved(t)!==!1&&(l.removeChild(t),d.callbacks.afterNodeRemoved(t));return d.head.afterHeadMorphed(l,{added:f,kept:u,removed:p}),e}const H=function(){function l(n,e,t){const{persistentIds:r,idMap:s}=u(n,e),o=v(t),h=o.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(h))throw`Do not understand how to morph style ${h}`;return{target:n,newContent:e,config:o,morphStyle:h,ignoreActive:o.ignoreActive,ignoreActiveValue:o.ignoreActiveValue,restoreFocus:o.restoreFocus,idMap:s,persistentIds:r,pantry:d(),callbacks:o.callbacks,head:o.head}}function v(n){let e=Object.assign({},a);return Object.assign(e,n),e.callbacks=Object.assign({},a.callbacks,n.callbacks),e.head=Object.assign({},a.head,n.head),e}function d(){const n=document.createElement("div");return n.hidden=!0,document.body.insertAdjacentElement("afterend",n),n}function f(n){let e=Array.from(n.querySelectorAll("[id]"));return n.id&&e.push(n),e}function p(n,e,t,r){for(const s of r)if(e.has(s.id)){let o=s;for(;o;){let h=n.get(o);if(h==null&&(h=new Set,n.set(o,h)),h.add(s.id),o===t)break;o=o.parentElement}}}function u(n,e){const t=f(n),r=f(e),s=i(t,r);let o=new Map;p(o,s,n,t);const h=e.__idiomorphRoot||e;return p(o,s,h,r),{persistentIds:s,idMap:o}}function i(n,e){let t=new Set,r=new Map;for(const{id:o,tagName:h}of n)r.has(o)?t.add(o):r.set(o,h);let s=new Set;for(const{id:o,tagName:h}of e)s.has(o)?t.add(o):r.get(o)===h&&s.add(o);for(const o of t)s.delete(o);return s}return l}(),{normalizeElement:A,normalizeParent:L}=function(){const l=new WeakSet;function v(u){return u instanceof Document?u.documentElement:u}function d(u){if(u==null)return document.createElement("div");if(typeof u=="string")return d(p(u));if(l.has(u))return u;if(u instanceof Node){if(u.parentNode)return new f(u);{const i=document.createElement("div");return i.append(u),i}}else{const i=document.createElement("div");for(const n of[...u])i.append(n);return i}}class f{constructor(i){this.originalNode=i,this.realParentNode=i.parentNode,this.previousSibling=i.previousSibling,this.nextSibling=i.nextSibling}get childNodes(){const i=[];let n=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;n&&n!=this.nextSibling;)i.push(n),n=n.nextSibling;return i}querySelectorAll(i){return this.childNodes.reduce((n,e)=>{if(e instanceof Element){e.matches(i)&&n.push(e);const t=e.querySelectorAll(i);for(let r=0;r<t.length;r++)n.push(t[r])}return n},[])}insertBefore(i,n){return this.realParentNode.insertBefore(i,n)}moveBefore(i,n){return this.realParentNode.moveBefore(i,n)}get __idiomorphRoot(){return this.originalNode}}function p(u){let i=new DOMParser,n=u.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(n.match(/<\/html>/)||n.match(/<\/head>/)||n.match(/<\/body>/)){let e=i.parseFromString(u,"text/html");if(n.match(/<\/html>/))return l.add(e),e;{let t=e.firstChild;return t&&l.add(t),t}}else{let t=i.parseFromString("<body><template>"+u+"</template></body>","text/html").body.querySelector("template").content;return l.add(t),t}}return{normalizeElement:v,normalizeParent:d}}();return{morph:c,defaults:a}}();const S={prefix:"visual:",initialize:"initialize",editorInitialized:"editor:init",settingUpdate:"setting:update",usedColors:"usedColors",sectionHighlight:"section:highlight",sectionSelect:"section:select",clearActiveSection:"clearActiveSection",sectionsOrder:"sectionsOrder",refreshPreview:"refresh",moveSectionUp:"section:move-up",moveSectionDown:"section:move-down",editSection:"section:edit",toggleSection:"section:toggle",removeSection:"section:remove"};class R{constructor(){k(this,"inDesignMode",!0);k(this,"inPreviewMode",!1)}on(a,c){const m=a.startsWith(S.prefix)?a:S.prefix+a,w=y=>c(y.detail);return document.addEventListener(m,w),()=>document.removeEventListener(m,w)}_dispatch(a,c){const m=S.prefix+a;document.dispatchEvent(new CustomEvent(m,{detail:c}))}handleLiveUpdate(a,c){this.on(S.settingUpdate,({data:m,skipRefresh:w})=>{var v,d,f;const{section:y,block:I,settingId:B,settingValue:E}=m;if(!y||y.type!==a)return;const H=document.querySelector(`[data-section-id="${y.id}"]`);if(!H)return;let A;if(I?A=(d=(v=c.blocks)==null?void 0:v[I.type])==null?void 0:d[B]:A=(f=c.section)==null?void 0:f[B],!A)return;const L=A.target?H.querySelector(A.target):null;if(!L)return;const l=typeof A.transform=="function"?A.transform(E):E;typeof A.handler=="function"?A.handler(L,l):A.html?L.innerHTML=l:A.text?L.textContent=l:A.style?L.style[A.style]=l:A.attr&&L.setAttribute(A.attr,l),w()})}}window.Visual=new R;class ${constructor(){k(this,"sectionOverlay");k(this,"sectionLabel");k(this,"moveUpBtn");k(this,"moveDownBtn");k(this,"editBtn");k(this,"disableBtn");k(this,"removeBtn");k(this,"activeSectionId",null);k(this,"sectionsOrder",[]);k(this,"hoverDebounce",0);k(this,"resizeObserver")}init(){this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),this.moveUpBtn=this.sectionOverlay.querySelector("#move-up"),this.moveDownBtn=this.sectionOverlay.querySelector("#move-down"),this.editBtn=this.sectionOverlay.querySelector("#edit"),this.disableBtn=this.sectionOverlay.querySelector("#disable"),this.removeBtn=this.sectionOverlay.querySelector("#remove"),this.moveUpBtn.addEventListener("click",()=>this.postMessage(S.moveSectionUp,this.activeSectionId)),this.moveDownBtn.addEventListener("click",()=>this.postMessage(S.moveSectionDown,this.activeSectionId)),this.editBtn.addEventListener("click",()=>this.postMessage(S.editSection,this.activeSectionId)),this.disableBtn.addEventListener("click",()=>this.postMessage(S.toggleSection,this.activeSectionId)),this.removeBtn.addEventListener("click",()=>this.postMessage(S.removeSection,this.activeSectionId)),this.attachMouseEvents(),this.postMessage(S.initialize,{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema}),this.sectionsOrder=window.themeData.sectionsOrder,window.addEventListener("message",({data:a})=>this.handleMessage(a)),this.extractUsedColors()}attachMouseEvents(){document.addEventListener("mouseover",a=>{if(!(a.target instanceof Element))return;const c=a.target.closest("[data-section-type]");c&&c.dataset.sectionId!==this.activeSectionId&&this.debounceHighlight(c)},{passive:!0}),document.addEventListener("mouseleave",a=>{if(!(a.target instanceof Element))return;const c=a.target.closest("[data-section-type]");if(!c)return;const m=a.relatedTarget;c.dataset.sectionId===this.activeSectionId&&(!m||!this.sectionOverlay.contains(m))&&this.clearActiveSection()},{passive:!0})}debounceHighlight(a){clearTimeout(this.hoverDebounce),this.hoverDebounce=window.setTimeout(()=>{this.highlightSection(a);const c=a.getBoundingClientRect();(c.top<0||c.bottom>window.innerHeight)&&a.scrollIntoView({behavior:"smooth",block:"nearest"})},50)}highlightSection(a){this.activeSectionId=a.dataset.sectionId;const c=a.getBoundingClientRect();window.requestAnimationFrame(()=>{Object.assign(this.sectionOverlay.style,{display:"block",width:`${c.width}px`,height:`${c.height}px`,left:`${c.left+window.scrollX}px`,top:`${c.top+window.scrollY}px`}),this.sectionLabel.textContent=a.dataset.sectionName||"";const m=this.sectionsOrder.indexOf(this.activeSectionId);m>0?this.moveUpBtn.style.display="inline":this.moveUpBtn.style.display="none",m>0&&m<this.sectionsOrder.length-1?this.moveDownBtn.style.display="inline":this.moveDownBtn.style.display="none",this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(()=>this.highlightSection(a)),this.resizeObserver.observe(a)})}clearActiveSection(){this.activeSectionId=null,this.sectionOverlay.style.display="none",this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0)}postMessage(a,c){window.parent.postMessage({type:a,data:c},window.origin)}handleMessage({type:a,data:c,messageId:m}){switch(a){case S.sectionHighlight:const w=document.querySelector(`[data-section-id="${c}"]`);w&&this.highlightSection(w);break;case S.sectionSelect:if(this.activeSectionId===c)return;const y=document.querySelector(`[data-section-id="${c}"]`);y&&(this.highlightSection(y),window.Visual._dispatch(S.sectionSelect,{section:{id:y.dataset.sectionId,type:y.dataset.sectionType}}));break;case S.clearActiveSection:this.clearActiveSection();break;case S.sectionsOrder:this.sectionsOrder=c;break;case S.refreshPreview:this.refreshPreviewer(c);break;case S.settingUpdate:let I=!1;window.Visual._dispatch(S.settingUpdate,{data:c,skipRefresh:()=>I=!0}),this.activeSectionId&&this.highlightSection(document.querySelector(`[data-section-id="${this.activeSectionId}"]`)),m&&window.parent.postMessage({messageId:m,skipRefresh:I},window.origin);break;default:window.Visual._dispatch(a,c)}}refreshPreviewer(a){const c=new DOMParser().parseFromString(a,"text/html");if(D.morph(document.documentElement,c.documentElement,{callbacks:{beforeNodeMorphed(m,w){return typeof m._x_dataStack<"u"&&typeof window.Alpine.morph<"u"?(window.Alpine.morph(m,w),!1):!0}}}),this.activeSectionId){const m=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);m&&this.highlightSection(m)}}extractUsedColors(a=6){const c=new Map;document.querySelectorAll("*").forEach(w=>{const y=getComputedStyle(w);[y.backgroundColor,y.color].forEach(I=>{I&&I!=="transparent"&&I!=="rgba(0, 0, 0, 0)"&&c.set(I,(c.get(I)||0)+1)})});const m=Array.from(c.entries()).sort((w,y)=>y[1]-w[1]).slice(0,a).map(([w])=>w);this.postMessage(S.usedColors,m)}}window.addEventListener("DOMContentLoaded",()=>{new $().init(),document.dispatchEvent(new CustomEvent(S.prefix+S.editorInitialized))});
