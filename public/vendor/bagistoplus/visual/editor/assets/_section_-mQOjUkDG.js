import{_ as E}from"./trash-Bx14SgYQ.js";import{A as f,_ as U,a as W}from"./accordion-C9gdurUc.js";import{_ as G,a as ee,b as te,S as oe,c as ne}from"./sortable.core.esm-Dse1hS4s.js";import{d as F,u as L,X as O,o as n,c as d,e as r,a as s,t as v,w as P,f as k,g as se,h as Q,F as C,r as z,N as le,P as y,Q as e,b as S,R as i,i as $,Y as R,Z as ae}from"./index-CCCJ2_t6.js";import{g as ce}from"./utils-BZao-1VW.js";import"./x-mark-Cucpnyxb.js";const ie={class:""},re=["data-disabled"],ue={class:"handle flex-none py-1 px-1 rounded-md hover:bg-zinc-200 cursor-move"},de={class:"w-0 flex-1 truncate text-xs capitalize"},me=F({__name:"Block",props:{block:null},emits:["remove","toggle"],setup(u,{emit:w}){const b=L(),l=O(),o=w,a=u;function B(){b.push({name:"/[section].[block]",params:{block:a.block.id,section:l.params.section}})}function p(c){const h=new DOMParser().parseFromString(c,"text/html").body.textContent;return h==="undefined"||h==="null"?c:h}return(c,m)=>{const h=G,I=E,V=ee,N=te;return n(),d("div",ie,[r("div",{class:"flex rounded border border-zinc-100 hover:bg-zinc-100 cursor-pointer active:ring-inset active:ring-2 active:ring-gray-700 data-[disabled=true]:text-zinc-500","data-disabled":u.block.disabled},[r("button",ue,[s(h,{class:"inline w-4"})]),r("div",{onClick:B,class:"group mx-2 py-1 pr-1 text-sm flex-1 flex items-center max-w-full"},[r("div",de,v(u.block.settings.title||u.block.settings.heading||p(u.block.settings.text)||u.block.name),1),r("button",{onClick:m[0]||(m[0]=P(A=>o("remove"),["stop"])),class:"flex-none invisible group-hover:visible py-[1px] px-[2px] rounded-md hover:bg-zinc-200"},[s(I,{class:"inline w-4"})]),r("button",{onClick:m[1]||(m[1]=P(A=>o("toggle"),["stop"])),class:"flex-none invisible group-hover:visible py-[1px] px-[2px] rounded-md hover:bg-zinc-200 ml-1"},[u.block.disabled?(n(),k(N,{key:1,class:"inline w-4"})):(n(),k(V,{key:0,class:"inline w-4"}))])])],8,re)])}}}),_e=F({__name:"BlocksGroup",props:{blocks:null,order:null},emits:["reorder","toggleBlock","removeBlock"],setup(u,{emit:w}){const b=u,l=w,o=se("sortable");return Q(()=>{new oe(o.value,{animation:150,ghostClass:"sortable-ghost",onEnd({newIndex:a,oldIndex:B}){const p=[...b.order],c=p.splice(B,1)[0];p.splice(a,0,c),l("reorder",p)}})}),(a,B)=>{const p=me;return n(),d("div",{ref_key:"sortable",ref:o,class:"space-y-1"},[(n(!0),d(C,null,z(u.blocks,c=>(n(),k(p,{key:c.id,block:c,onToggle:m=>l("toggleBlock",c.id),onRemove:m=>l("removeBlock",c.id)},null,8,["block","onToggle","onRemove"]))),128))],512)}}}),pe={key:0,class:"flex flex-col h-full overflow-hidden relative w-full"},ge={class:"flex-none p-2 border-b"},fe={class:"flex items-center"},ve={class:"ml-2 truncate"},be={key:0,class:"mt-2 text-sm"},ke={class:"flex-1 overflow-y-auto"},he={key:1,class:"p-2 text-sm"},xe={key:0,class:"flex-none border-t"},Ce=F({__name:"[section]",setup(u){const w=L(),b=O(),l=le(),o=y(()=>l.getSectionData(b.params.section)),a=y(()=>o.value?l.getSectionBySlug(o.value.type):null),B=y(()=>l.canRemoveSection(b.params.section)),p=y(()=>{var t;return ce(((t=a.value)==null?void 0:t.settings)||[])}),c=y(()=>o.value.blocks_order.map(t=>o.value.blocks[t])),m=y(()=>{var g;const t=((g=a.value)==null?void 0:g.blocks)||[];return c.value.length===0?t:t.filter(x=>{const T=c.value.filter(M=>M.type===x.type);return x.limit===void 0?!0:T.length<x.limit})}),h=y(()=>{var t;return o.value.blocks_order.length<((t=a.value)==null?void 0:t.maxBlocks)});Q(()=>{l.selectSection(b.params.section)});function I(){w.back()}function V(){l.removeSection(b.params.section),I()}function N(t){return l.getThemeDataValue(`sectionsData.${o.value.id}.settings.${t}`)}function A(t,g){return l.updateThemeDataValue(`sectionsData.${o.value.id}.settings.${t}`,g)}function X(t){const g=a.value.blocks.find(x=>x.type===t);l.addBlockToSection(o.value.id,g)}function Y(t){l.updateThemeDataValue(["sectionsData",o.value.id,"blocks_order"],t)}function Z(t){l.toggleSectionBlock(o.value.id,t)}function j(t){l.removeSectionBlock(o.value.id,t)}return(t,g)=>{const x=U,T=ae,M=_e,q=ne,H=W,J=E;return e(a)?(n(),d("div",pe,[r("header",ge,[r("div",fe,[r("button",{class:"p-1 px-2 rounded hover:bg-gray-200 focus:outline-none",onClick:I},[s(x,{class:"inline w-4"})]),r("span",ve,v(e(o).settings.heading||e(a).name),1)]),e(a).description?(n(),d("p",be,v(e(a).description),1)):S("",!0)]),r("section",ke,[s(e(f).Root,{multiple:"",defaultValue:["blocks","Settings"]},{default:i(()=>[e(a).blocks.length>0?(n(),k(e(f).Item,{key:0,value:"blocks"},{default:i(()=>[s(e(f).ItemTrigger,null,{default:i(()=>[$(v(t.$t("Blocks"))+" ",1),s(e(f).ItemIndicator,null,{default:i(()=>[s(T)]),_:1})]),_:1}),s(e(f).ItemContent,null,{default:i(()=>[s(M,{class:"-mt-2 mb-2",blocks:e(c),order:e(o).blocks_order,onReorder:Y,onToggleBlock:Z,onRemoveBlock:j},null,8,["blocks","order"]),e(m).length>0?(n(),k(e(R).Root,{key:0,onSelect:g[0]||(g[0]=_=>X(_.value))},{default:i(()=>[s(e(R).Trigger,{disabled:!e(h),class:"w-full text-sm text-blue-600 disabled:text-zinc-500 rounded-lg cursor-pointer outline-0 inline-flex items-center gap-2 px-2 py-1 hover:bg-gray-200 focus:ring-1 focus:ring-gray-700"},{default:i(()=>[s(q,{class:"w-4 h-4 inline mr-1"}),$(" "+v(t.$t("Add Block")),1)]),_:1},8,["disabled"]),s(e(R).Positioner,{class:"w-[var(--reference-width)] !z-10"},{default:i(()=>[s(e(R).Content,{class:"flex flex-col outline-0 gap-1 p-1 bg-white shadow border rounded-lg data-[state=open]:animate-fade-in"},{default:i(()=>[(n(!0),d(C,null,z(e(m),_=>(n(),k(e(R).Item,{key:_.type,value:_.type,class:"outline-0 rounded cursor-pointer px-2 py-2 hover:bg-gray-200"},{default:i(()=>[$(v(_.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1})):S("",!0),(n(!0),d(C,null,z(e(p),_=>(n(),k(e(f).Item,{value:_.name,key:_.name},{default:i(()=>[s(e(f).ItemTrigger,null,{default:i(()=>[$(v(_.name)+" ",1),s(e(f).ItemIndicator,null,{default:i(()=>[s(T)]),_:1})]),_:2},1024),s(e(f).ItemContent,null,{default:i(()=>[(n(!0),d(C,null,z(_.settings,D=>(n(),k(H,{key:D.id,value:N(D.id),setting:D,onInput:K=>A(D.id,K)},null,8,["value","setting","onInput"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),e(a).settings.length>0?(n(),d(C,{key:0},[],64)):(n(),d("p",he,v(t.$t("This section has no configuration")),1))]),e(B)?(n(),d("footer",xe,[r("button",{class:"flex items-center w-full text-left py-2 px-4 text-red-500 hover:bg-gray-100",onClick:V},[s(J,{class:"inline mr-2 w-4"}),$(" "+v(t.$t("Remove section")),1)])])):S("",!0)])):S("",!0)}}});export{Ce as default};
