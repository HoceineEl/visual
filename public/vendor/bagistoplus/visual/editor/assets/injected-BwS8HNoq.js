var q=Object.defineProperty;var N=(w,a,c)=>a in w?q(w,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):w[a]=c;var L=(w,a,c)=>N(w,typeof a!="symbol"?a+"":a,c);var D=function(){const w=()=>{},a={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:w,afterNodeAdded:w,beforeNodeMorphed:w,afterNodeMorphed:w,beforeNodeRemoved:w,afterNodeRemoved:w,beforeAttributeUpdated:w},head:{style:"merge",shouldPreserve:l=>l.getAttribute("im-preserve")==="true",shouldReAppend:l=>l.getAttribute("im-re-append")==="true",shouldRemove:w,afterHeadMorphed:w},restoreFocus:!0};function c(l,v,d={}){l=I(l);const h=T(v),m=H(l,h,d),u=M(m,()=>O(m,l,h,i=>i.morphStyle==="innerHTML"?(g(i,l,h),Array.from(l.childNodes)):p(i,l,h)));return m.pantry.remove(),u}function p(l,v,d){const h=T(v);return g(l,h,d,v,v.nextSibling),Array.from(h.childNodes)}function M(l,v){var n;if(!l.config.restoreFocus)return v();let d=document.activeElement;if(!(d instanceof HTMLInputElement||d instanceof HTMLTextAreaElement))return v();const{id:h,selectionStart:m,selectionEnd:u}=d,i=v();return h&&h!==((n=document.activeElement)==null?void 0:n.id)&&(d=l.target.querySelector(`[id="${h}"]`),d==null||d.focus()),d&&!d.selectionEnd&&u&&d.setSelectionRange(m,u),i}const g=function(){function l(e,t,r,s=null,o=null){t instanceof HTMLTemplateElement&&r instanceof HTMLTemplateElement&&(t=t.content,r=r.content),s||(s=t.firstChild);for(const f of r.childNodes){if(s&&s!=o){const b=d(e,f,s,o);if(b){b!==s&&m(e,s,b),A(b,f,e),s=b.nextSibling;continue}}if(f instanceof Element&&e.persistentIds.has(f.id)){const b=u(t,f.id,s,e);A(b,f,e),s=b.nextSibling;continue}const S=v(t,f,s,e);S&&(s=S.nextSibling)}for(;s&&s!=o;){const f=s;s=s.nextSibling,h(e,f)}}function v(e,t,r,s){if(s.callbacks.beforeNodeAdded(t)===!1)return null;if(s.idMap.has(t)){const o=document.createElement(t.tagName);return e.insertBefore(o,r),A(o,t,s),s.callbacks.afterNodeAdded(o),o}else{const o=document.importNode(t,!0);return e.insertBefore(o,r),s.callbacks.afterNodeAdded(o),o}}const d=function(){function e(s,o,f,S){let b=null,E=o.nextSibling,V=0,k=f;for(;k&&k!=S;){if(r(k,o)){if(t(s,k,o))return k;b===null&&(s.idMap.has(k)||(b=k))}if(b===null&&E&&r(k,E)&&(V++,E=E.nextSibling,V>=2&&(b=void 0)),k.contains(document.activeElement))break;k=k.nextSibling}return b||null}function t(s,o,f){let S=s.idMap.get(o),b=s.idMap.get(f);if(!b||!S)return!1;for(const E of S)if(b.has(E))return!0;return!1}function r(s,o){const f=s,S=o;return f.nodeType===S.nodeType&&f.tagName===S.tagName&&(!f.id||f.id===S.id)}return e}();function h(e,t){var r;if(e.idMap.has(t))n(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;(r=t.parentNode)==null||r.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function m(e,t,r){let s=t;for(;s&&s!==r;){let o=s;s=s.nextSibling,h(e,o)}return s}function u(e,t,r,s){const o=s.target.id===t&&s.target||s.target.querySelector(`[id="${t}"]`)||s.pantry.querySelector(`[id="${t}"]`);return i(o,s),n(e,o,r),o}function i(e,t){const r=e.id;for(;e=e.parentNode;){let s=t.idMap.get(e);s&&(s.delete(r),s.size||t.idMap.delete(e))}}function n(e,t,r){if(e.moveBefore)try{e.moveBefore(t,r)}catch{e.insertBefore(t,r)}else e.insertBefore(t,r)}return l}(),A=function(){function l(i,n,e){return e.ignoreActive&&i===document.activeElement?null:(e.callbacks.beforeNodeMorphed(i,n)===!1||(i instanceof HTMLHeadElement&&e.head.ignore||(i instanceof HTMLHeadElement&&e.head.style!=="morph"?B(i,n,e):(v(i,n,e),u(i,e)||g(e,i,n))),e.callbacks.afterNodeMorphed(i,n)),i)}function v(i,n,e){let t=n.nodeType;if(t===1){const r=i,s=n,o=r.attributes,f=s.attributes;for(const S of f)m(S.name,r,"update",e)||r.getAttribute(S.name)!==S.value&&r.setAttribute(S.name,S.value);for(let S=o.length-1;0<=S;S--){const b=o[S];if(b&&!s.hasAttribute(b.name)){if(m(b.name,r,"remove",e))continue;r.removeAttribute(b.name)}}u(r,e)||d(r,s,e)}(t===8||t===3)&&i.nodeValue!==n.nodeValue&&(i.nodeValue=n.nodeValue)}function d(i,n,e){if(i instanceof HTMLInputElement&&n instanceof HTMLInputElement&&n.type!=="file"){let t=n.value,r=i.value;h(i,n,"checked",e),h(i,n,"disabled",e),n.hasAttribute("value")?r!==t&&(m("value",i,"update",e)||(i.setAttribute("value",t),i.value=t)):m("value",i,"remove",e)||(i.value="",i.removeAttribute("value"))}else if(i instanceof HTMLOptionElement&&n instanceof HTMLOptionElement)h(i,n,"selected",e);else if(i instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement){let t=n.value,r=i.value;if(m("value",i,"update",e))return;t!==r&&(i.value=t),i.firstChild&&i.firstChild.nodeValue!==t&&(i.firstChild.nodeValue=t)}}function h(i,n,e,t){const r=n[e],s=i[e];if(r!==s){const o=m(e,i,"update",t);o||(i[e]=n[e]),r?o||i.setAttribute(e,""):m(e,i,"remove",t)||i.removeAttribute(e)}}function m(i,n,e,t){return i==="value"&&t.ignoreActiveValue&&n===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(i,n,e)===!1}function u(i,n){return!!n.ignoreActiveValue&&i===document.activeElement&&i!==document.body}return l}();function O(l,v,d,h){if(l.head.block){const m=v.querySelector("head"),u=d.querySelector("head");if(m&&u){const i=B(m,u,l);return Promise.all(i).then(()=>{const n=Object.assign(l,{head:{block:!1,ignore:!0}});return h(n)})}}return h(l)}function B(l,v,d){let h=[],m=[],u=[],i=[],n=new Map;for(const t of v.children)n.set(t.outerHTML,t);for(const t of l.children){let r=n.has(t.outerHTML),s=d.head.shouldReAppend(t),o=d.head.shouldPreserve(t);r||o?s?m.push(t):(n.delete(t.outerHTML),u.push(t)):d.head.style==="append"?s&&(m.push(t),i.push(t)):d.head.shouldRemove(t)!==!1&&m.push(t)}i.push(...n.values());let e=[];for(const t of i){let r=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(d.callbacks.beforeNodeAdded(r)!==!1){if("href"in r&&r.href||"src"in r&&r.src){let s,o=new Promise(function(f){s=f});r.addEventListener("load",function(){s()}),e.push(o)}l.appendChild(r),d.callbacks.afterNodeAdded(r),h.push(r)}}for(const t of m)d.callbacks.beforeNodeRemoved(t)!==!1&&(l.removeChild(t),d.callbacks.afterNodeRemoved(t));return d.head.afterHeadMorphed(l,{added:h,kept:u,removed:m}),e}const H=function(){function l(n,e,t){const{persistentIds:r,idMap:s}=u(n,e),o=v(t),f=o.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(f))throw`Do not understand how to morph style ${f}`;return{target:n,newContent:e,config:o,morphStyle:f,ignoreActive:o.ignoreActive,ignoreActiveValue:o.ignoreActiveValue,restoreFocus:o.restoreFocus,idMap:s,persistentIds:r,pantry:d(),callbacks:o.callbacks,head:o.head}}function v(n){let e=Object.assign({},a);return Object.assign(e,n),e.callbacks=Object.assign({},a.callbacks,n.callbacks),e.head=Object.assign({},a.head,n.head),e}function d(){const n=document.createElement("div");return n.hidden=!0,document.body.insertAdjacentElement("afterend",n),n}function h(n){let e=Array.from(n.querySelectorAll("[id]"));return n.id&&e.push(n),e}function m(n,e,t,r){for(const s of r)if(e.has(s.id)){let o=s;for(;o;){let f=n.get(o);if(f==null&&(f=new Set,n.set(o,f)),f.add(s.id),o===t)break;o=o.parentElement}}}function u(n,e){const t=h(n),r=h(e),s=i(t,r);let o=new Map;m(o,s,n,t);const f=e.__idiomorphRoot||e;return m(o,s,f,r),{persistentIds:s,idMap:o}}function i(n,e){let t=new Set,r=new Map;for(const{id:o,tagName:f}of n)r.has(o)?t.add(o):r.set(o,f);let s=new Set;for(const{id:o,tagName:f}of e)s.has(o)?t.add(o):r.get(o)===f&&s.add(o);for(const o of t)s.delete(o);return s}return l}(),{normalizeElement:I,normalizeParent:T}=function(){const l=new WeakSet;function v(u){return u instanceof Document?u.documentElement:u}function d(u){if(u==null)return document.createElement("div");if(typeof u=="string")return d(m(u));if(l.has(u))return u;if(u instanceof Node){if(u.parentNode)return new h(u);{const i=document.createElement("div");return i.append(u),i}}else{const i=document.createElement("div");for(const n of[...u])i.append(n);return i}}class h{constructor(i){this.originalNode=i,this.realParentNode=i.parentNode,this.previousSibling=i.previousSibling,this.nextSibling=i.nextSibling}get childNodes(){const i=[];let n=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;n&&n!=this.nextSibling;)i.push(n),n=n.nextSibling;return i}querySelectorAll(i){return this.childNodes.reduce((n,e)=>{if(e instanceof Element){e.matches(i)&&n.push(e);const t=e.querySelectorAll(i);for(let r=0;r<t.length;r++)n.push(t[r])}return n},[])}insertBefore(i,n){return this.realParentNode.insertBefore(i,n)}moveBefore(i,n){return this.realParentNode.moveBefore(i,n)}get __idiomorphRoot(){return this.originalNode}}function m(u){let i=new DOMParser,n=u.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(n.match(/<\/html>/)||n.match(/<\/head>/)||n.match(/<\/body>/)){let e=i.parseFromString(u,"text/html");if(n.match(/<\/html>/))return l.add(e),e;{let t=e.firstChild;return t&&l.add(t),t}}else{let t=i.parseFromString("<body><template>"+u+"</template></body>","text/html").body.querySelector("template").content;return l.add(t),t}}return{normalizeElement:v,normalizeParent:d}}();return{morph:c,defaults:a}}();const y={prefix:"visual:",initialize:"initialize",editorInitialized:"editor:init",settingUpdate:"setting:update",usedColors:"usedColors",sectionHighlight:"section:highlight",sectionSelect:"section:select",clearActiveSection:"clearActiveSection",sectionsOrder:"sectionsOrder",refreshPreview:"refresh",moveSectionUp:"section:move-up",moveSectionDown:"section:move-down",editSection:"section:edit",toggleSection:"section:toggle",removeSection:"section:remove"};class R{constructor(){L(this,"inDesignMode",!0);L(this,"inPreviewMode",!1)}on(a,c){const p=a.startsWith(y.prefix)?a:y.prefix+a,M=g=>c(g.detail);return document.addEventListener(p,M),()=>document.removeEventListener(p,M)}_dispatch(a,c){const p=y.prefix+a;document.dispatchEvent(new CustomEvent(p,{detail:c}))}handleLiveUpdate(a,c){this.on(y.settingUpdate,({data:p,skipRefresh:M})=>{var v,d,h;const{section:g,block:A,settingId:O,settingValue:B}=p;if(!g||g.type!==a)return;const H=document.querySelector(`[data-section-id="${g.id}"]`);if(!H)return;let I;if(A?I=(d=(v=c.blocks)==null?void 0:v[A.type])==null?void 0:d[O]:I=(h=c.section)==null?void 0:h[O],!I)return;const T=I.target?H.querySelector(I.target):null;if(!T)return;const l=typeof I.transform=="function"?I.transform(B):B;typeof I.handler=="function"?I.handler(T,l):I.html?T.innerHTML=l:I.text?T.textContent=l:I.style?T.style[I.style]=l:I.attr&&T.setAttribute(I.attr,l),M()})}}window.Visual=new R;class U{constructor(){L(this,"sectionOverlay");L(this,"sectionLabel");L(this,"moveUpBtn");L(this,"moveDownBtn");L(this,"editBtn");L(this,"disableBtn");L(this,"removeBtn");L(this,"activeSectionId",null);L(this,"sectionsOrder",[]);L(this,"hoverDebounce",0);L(this,"resizeObserver")}init(){this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),this.moveUpBtn=this.sectionOverlay.querySelector("#move-up"),this.moveDownBtn=this.sectionOverlay.querySelector("#move-down"),this.editBtn=this.sectionOverlay.querySelector("#edit"),this.disableBtn=this.sectionOverlay.querySelector("#disable"),this.removeBtn=this.sectionOverlay.querySelector("#remove"),this.moveUpBtn.addEventListener("click",()=>this.postMessage(y.moveSectionUp,this.activeSectionId)),this.moveDownBtn.addEventListener("click",()=>this.postMessage(y.moveSectionDown,this.activeSectionId)),this.editBtn.addEventListener("click",()=>this.postMessage(y.editSection,this.activeSectionId)),this.disableBtn.addEventListener("click",()=>this.postMessage(y.toggleSection,this.activeSectionId)),this.removeBtn.addEventListener("click",()=>this.postMessage(y.removeSection,this.activeSectionId)),this.attachMouseEvents(),this.postMessage(y.initialize,{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema}),this.sectionsOrder=window.themeData.sectionsOrder,window.addEventListener("message",({data:a})=>this.handleMessage(a)),this.extractUsedColors()}attachMouseEvents(){document.addEventListener("mouseover",a=>{if(!(a.target instanceof Element))return;const c=a.target.closest("[data-section-type]");c&&c.dataset.sectionId!==this.activeSectionId&&this.debounceHighlight(c)},{passive:!0}),document.addEventListener("mouseleave",a=>{if(!(a.target instanceof Element))return;const c=a.target.closest("[data-section-type]");if(!c)return;const p=a.relatedTarget;c.dataset.sectionId===this.activeSectionId&&(!p||!this.sectionOverlay.contains(p))&&this.clearActiveSection()},{passive:!0})}debounceHighlight(a){clearTimeout(this.hoverDebounce),this.hoverDebounce=window.setTimeout(()=>{this.highlightSection(a);const c=a.getBoundingClientRect();(c.top<0||c.bottom>window.innerHeight)&&a.scrollIntoView({behavior:"smooth",block:"nearest"})},50)}highlightSection(a){this.activeSectionId=a.dataset.sectionId;const c=a.getBoundingClientRect();window.requestAnimationFrame(()=>{Object.assign(this.sectionOverlay.style,{display:"block",width:`${c.width}px`,height:`${c.height}px`,left:`${c.left+window.scrollX}px`,top:`${c.top+window.scrollY}px`}),this.sectionLabel.textContent=a.dataset.sectionName||"";const p=this.sectionsOrder.indexOf(this.activeSectionId);p>0?this.moveUpBtn.style.display="inline":this.moveUpBtn.style.display="none",p>0&&p<this.sectionsOrder.length-1?this.moveDownBtn.style.display="inline":this.moveDownBtn.style.display="none",this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(()=>this.highlightSection(a)),this.resizeObserver.observe(a)})}clearActiveSection(){this.activeSectionId=null,this.sectionOverlay.style.display="none",this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0)}postMessage(a,c){window.parent.postMessage({type:a,data:c},window.origin)}handleMessage({type:a,data:c,messageId:p}){switch(a){case y.sectionHighlight:const M=document.querySelector(`[data-section-id="${c}"]`);M&&this.highlightSection(M);break;case y.sectionSelect:if(this.activeSectionId===c)return;const g=document.querySelector(`[data-section-id="${c}"]`);g&&(this.highlightSection(g),window.Visual._dispatch(y.sectionSelect,{section:{id:g.dataset.sectionId,type:g.dataset.sectionType}}));break;case y.clearActiveSection:this.clearActiveSection();break;case y.sectionsOrder:this.sectionsOrder=c;break;case y.refreshPreview:this.refreshPreviewer(c);break;case y.settingUpdate:let A=!1;this.autoHandleLiveUpdate(c)?A=!0:window.Visual._dispatch(y.settingUpdate,{data:c,skipRefresh:()=>A=!0}),this.activeSectionId&&this.highlightSection(document.querySelector(`[data-section-id="${this.activeSectionId}"]`)),p&&window.parent.postMessage({messageId:p,skipRefresh:A},window.origin);break;default:window.Visual._dispatch(a,c)}}autoHandleLiveUpdate(a){const{section:c,block:p,settingId:M,settingValue:g}=a,A=[c.id,p==null?void 0:p.id,M].filter(Boolean).join(":"),O=document.querySelector(`[data-live-update-key="${A}"]`);return O?(O.dataset.liveUpdateAttr?O.setAttribute(O.dataset.liveUpdateAttr,g):O.innerHTML=g,!0):!1}refreshPreviewer(a){const c=new DOMParser().parseFromString(a,"text/html");if(D.morph(document.documentElement,c.documentElement,{callbacks:{beforeNodeMorphed(p,M){return typeof p._x_dataStack<"u"&&typeof window.Alpine.morph<"u"?(window.Alpine.morph(p,M),!1):!0}}}),this.activeSectionId){const p=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);p&&this.highlightSection(p)}}extractUsedColors(a=6){const c=new Map;document.querySelectorAll("*").forEach(M=>{const g=getComputedStyle(M);[g.backgroundColor,g.color].forEach(A=>{A&&A!=="transparent"&&A!=="rgba(0, 0, 0, 0)"&&c.set(A,(c.get(A)||0)+1)})});const p=Array.from(c.entries()).sort((M,g)=>g[1]-M[1]).slice(0,a).map(([M])=>M);this.postMessage(y.usedColors,p)}}window.addEventListener("DOMContentLoaded",()=>{new U().init(),document.dispatchEvent(new CustomEvent(y.prefix+y.editorInitialized))});
