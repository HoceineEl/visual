var oe=Object.defineProperty;var ce=(a,e,t)=>e in a?oe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var S=(a,e,t)=>ce(a,typeof e!="symbol"?e+"":e,t);var J=11;function de(a,e){var t=e.attributes,n,i,r,c,h;if(!(e.nodeType===J||a.nodeType===J)){for(var g=t.length-1;g>=0;g--)n=t[g],i=n.name,r=n.namespaceURI,c=n.value,r?(i=n.localName||i,h=a.getAttributeNS(r,i),h!==c&&(n.prefix==="xmlns"&&(i=n.name),a.setAttributeNS(r,i,c))):(h=a.getAttribute(i),h!==c&&a.setAttribute(i,c));for(var m=a.attributes,u=m.length-1;u>=0;u--)n=m[u],i=n.name,r=n.namespaceURI,r?(i=n.localName||i,e.hasAttributeNS(r,i)||a.removeAttributeNS(r,i)):e.hasAttribute(i)||a.removeAttribute(i)}}var $,le="http://www.w3.org/1999/xhtml",E=typeof document>"u"?void 0:document,he=!!E&&"content"in E.createElement("template"),ue=!!E&&E.createRange&&"createContextualFragment"in E.createRange();function ve(a){var e=E.createElement("template");return e.innerHTML=a,e.content.childNodes[0]}function fe(a){$||($=E.createRange(),$.selectNode(E.body));var e=$.createContextualFragment(a);return e.childNodes[0]}function Se(a){var e=E.createElement("body");return e.innerHTML=a,e.childNodes[0]}function pe(a){return a=a.trim(),he?ve(a):ue?fe(a):Se(a)}function q(a,e){var t=a.nodeName,n=e.nodeName,i,r;return t===n?!0:(i=t.charCodeAt(0),r=n.charCodeAt(0),i<=90&&r>=97?t===n.toUpperCase():r<=90&&i>=97?n===t.toUpperCase():!1)}function Ee(a,e){return!e||e===le?E.createElement(a):E.createElementNS(e,a)}function ge(a,e){for(var t=a.firstChild;t;){var n=t.nextSibling;e.appendChild(t),t=n}return e}function X(a,e,t){a[t]!==e[t]&&(a[t]=e[t],a[t]?a.setAttribute(t,""):a.removeAttribute(t))}var Q={OPTION:function(a,e){var t=a.parentNode;if(t){var n=t.nodeName.toUpperCase();n==="OPTGROUP"&&(t=t.parentNode,n=t&&t.nodeName.toUpperCase()),n==="SELECT"&&!t.hasAttribute("multiple")&&(a.hasAttribute("selected")&&!e.selected&&(a.setAttribute("selected","selected"),a.removeAttribute("selected")),t.selectedIndex=-1)}X(a,e,"selected")},INPUT:function(a,e){X(a,e,"checked"),X(a,e,"disabled"),a.value!==e.value&&(a.value=e.value),e.hasAttribute("value")||a.removeAttribute("value")},TEXTAREA:function(a,e){var t=e.value;a.value!==t&&(a.value=t);var n=a.firstChild;if(n){var i=n.nodeValue;if(i==t||!t&&i==a.placeholder)return;n.nodeValue=t}},SELECT:function(a,e){if(!e.hasAttribute("multiple")){for(var t=-1,n=0,i=a.firstChild,r,c;i;)if(c=i.nodeName&&i.nodeName.toUpperCase(),c==="OPTGROUP")r=i,i=r.firstChild;else{if(c==="OPTION"){if(i.hasAttribute("selected")){t=n;break}n++}i=i.nextSibling,!i&&r&&(i=r.nextSibling,r=null)}a.selectedIndex=t}}},_=1,ee=11,te=3,ie=8;function w(){}function Te(a){if(a)return a.getAttribute&&a.getAttribute("id")||a.id}function me(a){return function(t,n,i){if(i||(i={}),typeof n=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var r=n;n=E.createElement("html"),n.innerHTML=r}else n=pe(n);else n.nodeType===ee&&(n=n.firstElementChild);var c=i.getNodeKey||Te,h=i.onBeforeNodeAdded||w,g=i.onNodeAdded||w,m=i.onBeforeElUpdated||w,u=i.onElUpdated||w,y=i.onBeforeNodeDiscarded||w,T=i.onNodeDiscarded||w,R=i.onBeforeElChildrenUpdated||w,ne=i.skipFromChildren||w,K=i.addChild||function(s,o){return s.appendChild(o)},P=i.childrenOnly===!0,N=Object.create(null),L=[];function M(s){L.push(s)}function j(s,o){if(s.nodeType===_)for(var v=s.firstChild;v;){var d=void 0;o&&(d=c(v))?M(d):(T(v),v.firstChild&&j(v,o)),v=v.nextSibling}}function U(s,o,v){y(s)!==!1&&(o&&o.removeChild(s),T(s),j(s,v))}function k(s){if(s.nodeType===_||s.nodeType===ee)for(var o=s.firstChild;o;){var v=c(o);v&&(N[v]=o),k(o),o=o.nextSibling}}k(t);function G(s){g(s);for(var o=s.firstChild;o;){var v=o.nextSibling,d=c(o);if(d){var l=N[d];l&&q(o,l)?(o.parentNode.replaceChild(l,o),x(l,o)):G(o)}else G(o);o=v}}function ae(s,o,v){for(;o;){var d=o.nextSibling;(v=c(o))?M(v):U(o,s,!0),o=d}}function x(s,o,v){var d=c(o);if(d&&delete N[d],!v){var l=m(s,o);if(l===!1||(l instanceof HTMLElement&&(s=l,k(s)),a(s,o),u(s),R(s,o)===!1))return}s.nodeName!=="TEXTAREA"?re(s,o):Q.TEXTAREA(s,o)}function re(s,o){var v=ne(s,o),d=o.firstChild,l=s.firstChild,C,I,D,H,A;e:for(;d;){for(H=d.nextSibling,C=c(d);!v&&l;){if(D=l.nextSibling,d.isSameNode&&d.isSameNode(l)){d=H,l=D;continue e}I=c(l);var B=l.nodeType,O=void 0;if(B===d.nodeType&&(B===_?(C?C!==I&&((A=N[C])?D===A?O=!1:(s.insertBefore(A,l),I?M(I):U(l,s,!0),l=A,I=c(l)):O=!1):I&&(O=!1),O=O!==!1&&q(l,d),O&&x(l,d)):(B===te||B==ie)&&(O=!0,l.nodeValue!==d.nodeValue&&(l.nodeValue=d.nodeValue))),O){d=H,l=D;continue e}I?M(I):U(l,s,!0),l=D}if(C&&(A=N[C])&&q(A,d))v||K(s,A),x(A,d);else{var z=h(d);z!==!1&&(z&&(d=z),d.actualize&&(d=d.actualize(s.ownerDocument||E)),K(s,d),G(d))}d=H,l=D}ae(s,l,I);var Y=Q[s.nodeName];Y&&Y(s,o)}var f=t,V=f.nodeType,Z=n.nodeType;if(!P){if(V===_)Z===_?q(t,n)||(T(t),f=ge(t,Ee(n.nodeName,n.namespaceURI))):f=n;else if(V===te||V===ie){if(Z===V)return f.nodeValue!==n.nodeValue&&(f.nodeValue=n.nodeValue),f;f=n}}if(f===n)T(t);else{if(n.isSameNode&&n.isSameNode(f))return;if(x(f,n,P),L)for(var F=0,se=L.length;F<se;F++){var W=N[L[F]];W&&U(W,W.parentNode,!1)}}return!P&&f!==t&&t.parentNode&&(f.actualize&&(f=f.actualize(t.ownerDocument||E)),t.parentNode.replaceChild(f,t)),f}}var Ie=me(de);const b={INITIALIZE:"initialize",MOVE_SECTION_UP:"section:move-up",MOVE_SECTION_DOWN:"section:move-down",EDIT_SECTION:"section:edit",TOGGLE_SECTION:"section:toggle",REMOVE_SECTION:"section:remove",SET_USED_COLORS:"usedColors"},p={prefix:"visual:",EDITOR_INITIALIZED:"editor:init",SETTING_UPDATED:"setting:updated",SECTION_HIGHLIGHT:"section:highlight",SECTION_SELECTED:"section:selected",SECTION_REMOVED:"section:removed",CLEAR_ACTIVE_SECTION:"clearActiveSection",SECTIONS_REORDERED:"sectionsOrder",REFRESH_PREVIEW:"refresh",REORDERING:"reordering"};class ye{constructor(){S(this,"inDesignMode",!0);S(this,"inPreviewMode",!1)}on(e,t){const n=e.startsWith(p.prefix)?e:p.prefix+e,i=r=>t(r.detail);return document.addEventListener(n,i),()=>document.removeEventListener(n,i)}_dispatch(e,t){const n=p.prefix+e;document.dispatchEvent(new CustomEvent(n,{detail:t,bubbles:!0}))}handleLiveUpdate(e,t){this.on(p.SETTING_UPDATED,({data:n,skipRefresh:i})=>{var R;const{section:r,block:c,settingId:h,settingValue:g}=n;if(!r||r.type!==e)return;const m=document.querySelector(`[data-section-id="${r.id}"]`);if(!m)return;let u;if(c&&((R=t.blocks)!=null&&R[c.type])?u=t.blocks[c.type][h]:t.section&&(u=t.section[h]),!u)return;const y=u.target?m.querySelector(u.target):null;if(!y)return;const T=typeof u.transform=="function"?u.transform(g):g;typeof u.handler=="function"?u.handler(y,T):u.html?y.innerHTML=T:u.text?y.textContent=T:u.style?y.style[u.style]=T:u.attr&&y.setAttribute(u.attr,T),i()})}}window.Visual=new ye;class Ae{constructor(){S(this,"sectionOverlay");S(this,"sectionLabel");S(this,"moveUpBtn");S(this,"moveDownBtn");S(this,"editBtn");S(this,"disableBtn");S(this,"removeBtn");S(this,"buttonsContainer");S(this,"activeSectionId",null);S(this,"sectionsOrder",[]);S(this,"hoverDebounce",0);S(this,"reorderingSectionId",null);S(this,"messageHandlers",{[p.SECTION_HIGHLIGHT]:e=>this.handleSectionHighlight(e),[p.SECTION_SELECTED]:e=>this.handleSectionSelected(e),[p.SECTION_REMOVED]:e=>this.handleSectionRemoved(e),[p.CLEAR_ACTIVE_SECTION]:()=>this.handleClearActiveSection(),[p.SECTIONS_REORDERED]:e=>this.handleSectionsReordered(e),[p.REORDERING]:e=>this.handleReordering(e),[p.REFRESH_PREVIEW]:e=>this.refreshPreviewer(e),[p.SETTING_UPDATED]:(e,t)=>this.handleSettingUpdated(e,t)})}init(){this.initializeUIElements(),this.attachButtonEvents(),this.attachMouseEvents(),this.postMessage(b.INITIALIZE,{themeData:window.themeData,templates:window.templates,settingsSchema:window.settingsSchema}),this.sectionsOrder=window.themeData.sectionsOrder,window.addEventListener("message",({data:e})=>this.handleMessage(e)),window.addEventListener("resize",()=>this.handleWindowResize()),this.extractUsedColors()}initializeUIElements(){this.sectionOverlay=document.querySelector("#section-overlay"),this.sectionLabel=document.querySelector("#label"),this.buttonsContainer=document.querySelector("#buttons"),this.moveUpBtn=this.sectionOverlay.querySelector("#move-up"),this.moveDownBtn=this.sectionOverlay.querySelector("#move-down"),this.editBtn=this.sectionOverlay.querySelector("#edit"),this.disableBtn=this.sectionOverlay.querySelector("#disable"),this.removeBtn=this.sectionOverlay.querySelector("#remove")}attachButtonEvents(){this.moveUpBtn.onclick=()=>this.postMessage(b.MOVE_SECTION_UP,this.activeSectionId),this.moveDownBtn.onclick=()=>this.postMessage(b.MOVE_SECTION_DOWN,this.activeSectionId),this.editBtn.onclick=()=>this.postMessage(b.EDIT_SECTION,this.activeSectionId),this.disableBtn.onclick=()=>this.postMessage(b.TOGGLE_SECTION,this.activeSectionId),this.removeBtn.onclick=()=>this.postMessage(b.REMOVE_SECTION,this.activeSectionId)}attachMouseEvents(){document.addEventListener("mouseover",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest("[data-section-type]");t&&t.dataset.sectionId!==this.activeSectionId&&(this.buttonsContainer.style.display="flex",this.debounceHighlight(t))},{passive:!0}),document.addEventListener("mouseleave",e=>{if(!(e.target instanceof Element)){this.buttonsContainer.style.display="none",this.clearActiveSection();return}if(!e.target.closest("[data-section-type]"))return;const n=e.relatedTarget;(!n||!this.sectionOverlay.contains(n))&&(this.buttonsContainer.style.display="none",this.clearActiveSection())},{passive:!0})}handleWindowResize(){if(this.activeSectionId){const e=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);e&&this.highlightSection(e)}}debounceHighlight(e){clearTimeout(this.hoverDebounce),this.hoverDebounce=window.setTimeout(()=>{this.highlightSection(e)},50)}handleMessage({type:e,data:t,messageId:n}){const i=this.messageHandlers[e];i?i(t,n):window.Visual._dispatch(e,t)}handleSectionHighlight(e){if(this.reorderingSectionId)return;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"start"}),t.setAttribute("data-visual-highlighted","true"))}handleSectionSelected(e){if(this.activeSectionId===e)return;const t=document.querySelector(`[data-section-id="${e}"]`);t&&(this.highlightSection(t),t.scrollIntoView({behavior:"smooth",block:"start"}),window.Visual._dispatch(p.SECTION_SELECTED,{section:{id:t.dataset.sectionId,type:t.dataset.sectionType}}))}handleSectionRemoved(e){const t=document.querySelector(`[data-section-id="${e.id}"]`);t&&t.remove()}handleClearActiveSection(){this.clearActiveSection(),document.querySelectorAll("[data-visual-highlighted]").forEach(e=>{e.removeAttribute("data-visual-highlighted")})}handleSectionsReordered(e){this.sectionsOrder=e,this.reorderingSectionId=null,document.querySelectorAll("[data-reordering]").forEach(t=>{t.removeAttribute("data-reordering")})}handleReordering(e){this.reorderingSectionId=e.sectionId,e.order.forEach(n=>{const i=document.querySelector(`[data-section-id="${n}"]`);i!=null&&i.parentElement&&i.parentElement.appendChild(i)});const t=document.querySelector(`[data-section-id="${e.sectionId}"]`);t&&requestAnimationFrame(()=>{t.scrollIntoView({behavior:"smooth",block:"nearest"}),t.dataset.reordering="true"})}handleSettingUpdated(e,t){let n=this.autoHandleLiveUpdate(e);if(n||window.Visual._dispatch(p.SETTING_UPDATED,{data:e,skipRefresh:()=>{n=!0}}),this.activeSectionId){const i=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);i&&this.highlightSection(i)}t&&window.parent.postMessage({messageId:t,skipRefresh:n},window.origin)}highlightSection(e){this.activeSectionId=e.dataset.sectionId;const t=e.getBoundingClientRect();window.requestAnimationFrame(()=>{Object.assign(this.sectionOverlay.style,{display:"block",width:`${t.width}px`,height:`${t.height}px`,left:`${t.left+window.scrollX}px`,top:`${t.top+window.scrollY}px`}),this.sectionLabel.textContent=e.dataset.sectionName||"";const n=this.sectionsOrder.indexOf(this.activeSectionId);this.moveUpBtn.style.display=n>0?"inline":"none",this.moveDownBtn.style.display=n>0&&n<this.sectionsOrder.length-1?"inline":"none"})}clearActiveSection(){this.activeSectionId=null,this.sectionOverlay.style.display="none"}autoHandleLiveUpdate(e){const{section:t,block:n,settingId:i,settingValue:r}=e,c=[t==null?void 0:t.id,n==null?void 0:n.id,i].filter(Boolean).join(":"),h=document.querySelector(`[data-live-update-key="${c}"]`);return h?(h.dataset.liveUpdateAttr?h.setAttribute(h.dataset.liveUpdateAttr,r):h.innerHTML=r,!0):!1}patchNode(e,t){const n=this,i=r=>{var c;return((c=r.hasAttributes)==null?void 0:c.call(r))&&Array.from(r.attributes).some(h=>h.value.includes("$wire"))};Ie(e,t,{onBeforeElUpdated(r,c){var h;return r instanceof HTMLElement&&i(c)?(r.innerHTML=c.innerHTML,n.copyNonAlpineAttributes(r,c),!1):r._x_dataStack&&typeof((h=window.Alpine)==null?void 0:h.morph)=="function"?(window.Alpine.morph(r,c,{updating(g,m,u){if(g instanceof HTMLElement&&m instanceof HTMLElement&&g.hasAttribute("wire:id"))return u()}}),!1):!0}})}copyNonAlpineAttributes(e,t){const n=i=>i.startsWith("x-")||i.startsWith("@")||i.startsWith(":");Array.from(e.attributes).forEach(i=>{n(i.name)||e.removeAttribute(i.name)}),Array.from(t.attributes).forEach(i=>{n(i.name)||e.setAttribute(i.name,i.value)})}refreshPreviewer({html:e,updatedSections:t}){const n=new DOMParser().parseFromString(e,"text/html");if(t.size===0?this.patchNode(document.documentElement,n.documentElement):t.forEach((i,r)=>{const c=document.querySelector(`[data-section-id="${r}"]`),h=n.querySelector(`[data-section-id="${r}"]`);!c||!h||(this.patchNode(c,h),console.log(i),window.Visual._dispatch("section:updated",i))}),this.activeSectionId){const i=document.querySelector(`[data-section-id="${this.activeSectionId}"]`);i&&this.highlightSection(i)}}postMessage(e,t){window.parent.postMessage({type:e,data:t},window.origin)}extractUsedColors(e=6){const t=new Map;document.querySelectorAll("*").forEach(i=>{const r=getComputedStyle(i);[r.backgroundColor,r.color].forEach(c=>{c&&c!=="transparent"&&c!=="rgba(0, 0, 0, 0)"&&t.set(c,(t.get(c)||0)+1)})});const n=Array.from(t.entries()).sort((i,r)=>r[1]-i[1]).slice(0,e).map(([i])=>i);this.postMessage(b.SET_USED_COLORS,n)}}window.addEventListener("DOMContentLoaded",()=>{new Ae().init(),document.dispatchEvent(new CustomEvent(p.prefix+p.EDITOR_INITIALIZED,{bubbles:!0}))});
